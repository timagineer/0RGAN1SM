<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>0RGAN1SM</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Syne+Mono&display=swap" rel="stylesheet">
    <style>
        @layer config, reset, base, layout, components, utilities;

        @layer config {

            :root {
                /* Colors */
                --color-bg-primary: oklch(12% 0.03 275);
                --color-fg-primary: oklch(95% 0.01 280);
                --color-fg-secondary: oklch(70% 0.02 275);
                --color-border: oklch(40% 0.015 275);
                --color-accent: oklch(65% 0.22 265);
                --color-track: oklch(25% 0.01 270);
                --color-shadow-dark: oklch(12% 0.03 275 / 0.8);
                --color-shadow-medium: oklch(12% 0.03 275 / 0.6);
                --color-border-subtle: oklch(40% 0.015 275 / 0.1);

                /* Spacing */
                --space-2xs: 0.125rem;
                --space-xs: 0.25rem;
                --space-sm: 0.375rem;
                --space-md: 0.5rem;
                --space-lg: 0.75rem;
                --space-xl: 1rem;
                --space-xs-md: clamp(0.25rem, 0.1786rem + 0.3571vw, 0.5rem);
                --space-lg-xl: clamp(0.75rem, 0.6786rem + 0.3571vw, 1rem);

                /* Typography */
                --font-size-s: clamp(0.6875rem, 0.6696rem + 0.0893vw, 0.75rem);
                --font-size-m: clamp(0.75rem, 0.7321rem + 0.0893vw, 0.8125rem);
                --font-size-l: clamp(1.875rem, 1.7679rem + 0.5357vw, 2.25rem);

                /* Borders & Radius */
                --radius-circle: 50%;
                --radius-sm: 0.25rem;
                --border-dotted: 1px dotted var(--color-border);

                /* Component Background */
                --fieldset-bg-opacity: 0.6;
                --fieldset-bg-blur: 1.5px;
                --component-bg: oklch(0.08 0 0 / var(--fieldset-bg-opacity));

                /* Easings */
                --in-circ: cubic-bezier(0.55, 0, 1, 0.45);
                --in-cubic: cubic-bezier(0.32, 0, 0.67, 0);
                --in-expo: cubic-bezier(0.7, 0, 0.84, 0);
                --in-quad: cubic-bezier(0.11, 0, 0.5, 0);
                --in-quart: cubic-bezier(0.5, 0, 0.75, 0);
                --in-quint: cubic-bezier(0.64, 0, 0.78, 0);
                --in-sine: cubic-bezier(0.12, 0, 0.39, 0);

                --in-out-back: cubic-bezier(0.68, -0.6, 0.32, 1.6);
                --in-out-circ: cubic-bezier(0.85, 0, 0.15, 1);
                --in-out-cubic: cubic-bezier(0.65, 0, 0.35, 1);
                --in-out-expo: cubic-bezier(0.87, 0, 0.13, 1);
                --in-out-quad: cubic-bezier(0.45, 0, 0.55, 1);
                --in-out-quart: cubic-bezier(0.76, 0, 0.24, 1);
                --in-out-quint: cubic-bezier(0.83, 0, 0.17, 1);
                --in-out-sine: cubic-bezier(0.37, 0, 0.63, 1);

                --out-back: cubic-bezier(0.34, 1.56, 0.64, 1);
                --out-circ: cubic-bezier(0, 0.55, 0.45, 1);
                --out-cubic: cubic-bezier(0.33, 1, 0.68, 1);
                --out-expo: cubic-bezier(0.16, 1, 0.3, 1);
                --out-quad: cubic-bezier(0.5, 1, 0.89, 1);
                --out-quart: cubic-bezier(0.25, 1, 0.5, 1);
                --out-quint: cubic-bezier(0.22, 1, 0.36, 1);
                --out-sine: cubic-bezier(0.61, 1, 0.88, 1);

                /* Animation Constants */
                --particle-count: 1080;
                --metabolism-offset: 21;
                --canvas-multiplier: 3;
            }
        }

        @layer reset {

            *,
            ::after,
            ::before {
                box-sizing: border-box;
                margin: 0;
                padding: 0;
            }
        }

        @layer base {

            html,
            body {
                accent-color: var(--color-accent);
                color: var(--color-fg-primary);
                background-color: var(--color-bg-primary);
                block-size: 100dvh;
                inline-size: 100dvw;
                font-family: "Syne Mono", ui-monospace, monospace;
                font-weight: 400;
            }

            body {
                display: flex;
                flex-direction: column;
                overflow: hidden;
            }

            input:focus {
                outline: none;
            }

            input:focus-visible {
                outline: 2px dotted var(--color-accent);
                outline-offset: 2px;
                border-radius: var(--radius-sm);
            }

            *:focus-visible {
                outline: 2px dotted var(--color-accent);
                outline-offset: 2px;
                border-radius: var(--radius-sm);
            }

            *:focus:not(:focus-visible) {
                outline: none;
            }
        }

        @layer layout {

            .l-header,
            .l-footer {
                position: relative;
                z-index: 10;
                padding: var(--space-lg-xl);
                display: flex;
                gap: var(--space-lg-xl);
                align-items: center;
                justify-content: space-evenly;
                flex-wrap: wrap;
                flex-shrink: 0;
                background-color: transparent;
            }

            @media (max-width: 768px) {
                .l-footer {
                    justify-content: center;
                }
            }

            .l-organism-container {
                flex: 1;
                display: flex;
                align-items: center;
                justify-content: center;
                min-block-size: 0;
                position: relative;
                z-index: 1;
            }

            .l-organism-wrapper {
                inline-size: fit-content;
                block-size: fit-content;
            }

            .c-function-fieldset[data-function="impulse-x"] {
                order: 1;
            }

            .c-function-fieldset[data-function="resonance-x"] {
                order: 2;
            }

            .c-function-fieldset[data-function="resonance-y"] {
                order: 3;
            }

            .c-function-fieldset[data-function="impulse-y"] {
                order: 4;
            }

            @media (min-width: 768px) {
                .c-function-fieldset[data-function="impulse-x"] {
                    order: 1;
                }

                .c-function-fieldset[data-function="resonance-x"] {
                    order: 2;
                }

                .c-title {
                    order: 3;
                }

                .c-function-fieldset[data-function="resonance-y"] {
                    order: 4;
                }

                .c-function-fieldset[data-function="impulse-y"] {
                    order: 5;
                }

                .c-function-grid {
                    grid-template-columns: repeat(3, 1fr);
                    grid-template-rows: repeat(2, 1fr);
                    grid-template-areas:
                        "cos sin tan"
                        "acos asin atan";
                }
            }

            @media (max-width: 768px) {
                .c-title {
                    order: -1;
                }

                .c-function-grid {
                    grid-template-columns: repeat(6, 1fr);
                }
            }
        }

        @layer components {

            .c-particle {
                color: oklch(80% 0.015 calc(sin(var(--hue-angle, 10) * var(--i)) * var(--hue-bend, 40) + var(--hue-base, 275)));
                background: currentColor;
                border-radius: var(--radius-circle);
                opacity: 0;
                position: absolute;
                quotes: none;
                will-change: transform;
                block-size: calc(var(--cell-size) * 0.1vmin);
                inline-size: calc(var(--cell-size) * 0.1vmin);
                --duration: var(--organism-duration, 7s);
                --delay: calc(var(--i) * var(--duration) / var(--particle-count) * 4);
                transform: translate3d(var(--x-1), var(--y-1), 0);
            }

            .c-title {
                font-size: var(--font-size-l);
                text-align: center;
                font-variant-caps: all-small-caps;
                margin: 0;
                padding-block: var(--space-md);
                flex-basis: 100%;
                text-shadow: 0 0 8px var(--color-shadow-dark);
                position: relative;
                z-index: 20;
            }

            .c-title b {
                position: relative;
                bottom: 0.55ex;
                font-size: 0.625em;
            }

            .c-title var {
                font-style: normal;
                letter-spacing: -0.15ex;
            }

            .c-title a {
                color: inherit;
                text-decoration: none;
                cursor: pointer;
                position: relative;
                display: inline-block;
                transition-duration: 780ms;
                transition-property: transform;
                transition-timing-function: var(--in-out-back);
            }

            .c-title a:hover {
                transform: scale(1.1);
                transition-duration: 300ms;
                transition-timing-function: var(--out-back);
            }

            .c-title a:focus-visible:not(:hover) {
                outline: 2px dotted var(--color-accent);
                outline-offset: 4px;
                border-radius: var(--radius-sm);
            }

            .c-title a:hover {
                outline: none;
            }

            .c-title a:active {
                outline: none;
            }

            @media (min-width: 768px) {
                .c-title {
                    flex-basis: auto;
                }
            }

            .c-function-fieldset {
                border: var(--border-dotted);
                border-radius: var(--radius-sm);
                padding-block: var(--space-md);
                padding-inline: var(--space-md);
                min-width: 0;
                background-color: var(--component-bg);
                backdrop-filter: blur(var(--fieldset-bg-blur));
                box-shadow: 0 0 0 1px var(--color-border-subtle);
                z-index: 15;
                position: relative;
            }

            .c-function-legend {
                font-weight: 500;
                color: var(--color-fg-secondary);
                font-size: var(--font-size-m);
                padding-inline: var(--space-sm);
                text-align: center;
                text-shadow: 0 0 4px var(--color-shadow-dark);
            }

            .c-function-grid {
                display: grid;
                gap: var(--space-xs-md);
                margin-block: 0;
            }

            .c-function-grid label {
                font-size: var(--font-size-s);
                color: var(--color-fg-secondary);
                cursor: pointer;
                display: flex;
                align-items: center;
                justify-content: flex-start;
                gap: 5px;
                padding-block: var(--space-2xs);
                padding-inline: var(--space-2xs);
                text-align: left;
                text-shadow: 0 0 4px var(--color-shadow-medium);
            }

            .c-function-grid input[type="radio"] {
                margin: 0;
            }

            .c-control-fieldset {
                border: none;
                padding: 0;
                margin: 0;
                display: contents;
            }

            .c-control-group {
                border: var(--border-dotted);
                border-radius: var(--radius-sm);
                padding-block: var(--space-md) var(--space-lg);
                padding-inline: var(--space-md);
                display: flex;
                flex-direction: column;
                flex: 1;
                gap: var(--space-md);
                min-inline-size: 6rem;
                max-inline-size: 8rem;
                background-color: var(--component-bg);
                backdrop-filter: blur(var(--fieldset-bg-blur));
                box-shadow: 0 0 0 1px var(--color-border-subtle);
            }

            .c-control-header {
                display: flex;
                justify-content: space-between;
                align-items: baseline;
                gap: var(--space-xs);
            }

            .c-control-label {
                font-weight: 500;
                color: var(--color-fg-secondary);
                font-size: var(--font-size-m);
                text-align: left;
                flex-shrink: 0;
                text-shadow: 0 0 4px var(--color-shadow-dark);
            }

            .c-control-value {
                text-align: right;
                font-family: ui-monospace, monospace;
                color: var(--color-fg-secondary);
                font-size: var(--font-size-s);
                flex-shrink: 0;
                text-shadow: 0 0 4px var(--color-shadow-medium);
                /* Remove focus styles for output elements */
                outline: none;
            }

            .c-control-input {
                inline-size: 100%;
                margin-block-start: var(--space-xs);
            }

            .c-range-input {
                -webkit-appearance: none;
                appearance: none;
                inline-size: 100%;
                block-size: var(--space-xs);
                border-radius: var(--radius-sm);
                background: var(--color-track);
                outline: none;
            }

            .c-range-input::-webkit-slider-runnable-track {
                background-color: var(--color-track);
                border: 1px solid var(--color-border);
                border-radius: var(--radius-sm);
                cursor: grab;
                block-size: 0.33rem;
                inline-size: 100%;
            }

            .c-range-input::-webkit-slider-thumb {
                -webkit-appearance: none;
                appearance: none;
                inline-size: var(--space-xl);
                block-size: var(--space-xl);
                border-radius: var(--radius-circle);
                background: var(--color-accent);
                border: 1px solid var(--color-border);
                cursor: grab;
                margin-block-start: calc((0.33rem - var(--space-xl)) / 2 - 1px);
            }

            .c-range-input:hover::-webkit-slider-thumb {
                border-color: var(--color-fg-secondary);
            }

            .c-range-input:focus-visible::-webkit-slider-thumb {
                background-color: var(--color-accent);
                border-color: var(--color-accent);
                outline: 2px solid transparent;
                outline-offset: 2px;
            }

            .c-range-input:not([disabled]):active::-webkit-slider-thumb {
                cursor: grabbing;
            }

            .c-range-input::-moz-range-track {
                background-color: var(--color-track);
                border: 1px solid var(--color-border);
                border-radius: var(--radius-sm);
                cursor: grab;
                block-size: 0.33rem;
                inline-size: 100%;
            }

            .c-range-input::-moz-range-thumb {
                inline-size: var(--space-xl);
                block-size: var(--space-xl);
                border-radius: var(--radius-circle);
                background: var(--color-accent);
                border: 1px solid var(--color-border);
                cursor: grab;
            }

            .c-range-input:hover::-moz-range-thumb {
                border-color: var(--color-fg-secondary);
            }

            .c-range-input:focus-visible::-moz-range-thumb {
                background-color: var(--color-accent);
                border-color: var(--color-accent);
                outline: 2px solid transparent;
                outline-offset: 2px;
            }

            .c-range-input:not([disabled]):active::-moz-range-thumb {
                cursor: grabbing;
            }

            .c-range-input::-ms-track {
                background: transparent;
                border-color: transparent;
                border-width: 0;
                color: transparent;
                cursor: grab;
                block-size: 0.33rem;
                inline-size: 100%;
            }

            .c-range-input::-ms-thumb {
                inline-size: var(--space-xl);
                block-size: var(--space-xl);
                border-radius: var(--radius-circle);
                background: var(--color-accent);
                border: 1px solid var(--color-border);
                cursor: grab;
            }

            .c-range-input:hover::-ms-thumb {
                border-color: var(--color-fg-secondary);
            }

            .c-range-input:focus-visible::-ms-thumb {
                background-color: var(--color-accent);
                border-color: var(--color-accent);
                outline: 2px solid transparent;
                outline-offset: 2px;
            }

            .c-range-input:not([disabled]):active::-ms-thumb {
                cursor: grabbing;
            }

            .c-range-input::-ms-fill-lower {
                background-color: var(--color-track);
                border: 1px solid var(--color-border);
                border-radius: var(--radius-sm);
            }

            .c-range-input::-ms-fill-upper {
                background-color: var(--color-track);
                border: 1px solid var(--color-border);
                border-radius: var(--radius-sm);
            }

            .c-range-input:focus-visible::-ms-fill-upper {
                border-color: var(--color-accent);
            }

            .c-range-input:focus-visible {
                outline: 2px dotted var(--color-accent);
                outline-offset: 2px;
                border-radius: var(--radius-sm);
            }

            .c-live-region {
                position: absolute;
                width: 1px;
                height: 1px;
                padding: 0;
                margin: -1px;
                overflow: hidden;
                clip: rect(0, 0, 0, 0);
                white-space: nowrap;
                border: 0;
            }
        }

        @layer utilities {

            .u-visually-hidden {
                position: absolute;
                inline-size: 1px;
                block-size: 1px;
                padding: 0;
                margin: -1px;
                overflow: hidden;
                clip: rect(0, 0, 0, 0);
                white-space: nowrap;
                border: 0;
            }

            .u-skip-link {
                position: absolute;
                top: -40px;
                left: 6px;
                background: var(--color-accent);
                color: var(--color-bg-primary);
                padding: 8px;
                text-decoration: none;
                border-radius: var(--radius-sm);
                z-index: 1000;
                transition: top 0.3s;
            }

            .u-skip-link:focus {
                top: 6px;
            }
        }

        @keyframes organism {
            100% {
                transform: translate3d(var(--x-2), var(--y-2), 0);
                opacity: 1;
            }
        }

        @media (prefers-reduced-motion: no-preference) {

            .c-particle {
                animation: organism var(--duration) var(--in-out-sine) var(--delay) infinite alternate;
            }
        }

        @media (prefers-reduced-motion: reduce) {

            *,
            *::before,
            *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
                scroll-behavior: auto !important;
            }
        }

        * {
            /* outline: 0.5px dotted deeppink; */
        }
    </style>
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="theme-color" content="#040511">
    <meta name="author" content="Timothy Martens">
    <meta name="description" content="Interactive mathematical organism animation with customizable parameters">
</head>

<body>
    <a href="#main-content" class="u-skip-link">Skip to main content</a>

    <div id="js-live-region" class="c-live-region" aria-live="polite" aria-atomic="true"></div>

    <header class="l-header" role="banner" aria-label="Mathematical function controls">
        <h1 class="c-title">
            <span class="u-visually-hidden">Organism</span>
            <a href="#" class="js-randomize" aria-label="Randomize organism parameters (Press spacebar anywhere to randomize)" tabindex="0">
                0rgan<var>1</var><b>sm</b>
            </a>
        </h1>

        <fieldset class="c-function-fieldset" data-function="impulse-x">
            <legend class="c-function-legend" id="legend-impulse-x">Impulse X</legend>
            <div class="c-function-grid" role="radiogroup" aria-labelledby="legend-impulse-x">
                <label for="impulse-x-cos"><input type="radio" id="impulse-x-cos" name="impulse-x" value="cos">cos</label>
                <label for="impulse-x-sin"><input type="radio" id="impulse-x-sin" name="impulse-x" value="sin">sin</label>
                <label for="impulse-x-tan"><input type="radio" id="impulse-x-tan" name="impulse-x" value="tan">tan</label>
                <label for="impulse-x-acos"><input type="radio" id="impulse-x-acos" name="impulse-x" value="acos">acos</label>
                <label for="impulse-x-asin"><input type="radio" id="impulse-x-asin" name="impulse-x" value="asin">asin</label>
                <label for="impulse-x-atan"><input type="radio" id="impulse-x-atan" name="impulse-x" value="atan">atan</label>
            </div>
        </fieldset>

        <fieldset class="c-function-fieldset" data-function="resonance-x">
            <legend class="c-function-legend" id="legend-resonance-x">Resonance X</legend>
            <div class="c-function-grid" role="radiogroup" aria-labelledby="legend-resonance-x">
                <label for="resonance-x-cos"><input type="radio" id="resonance-x-cos" name="resonance-x" value="cos">cos</label>
                <label for="resonance-x-sin"><input type="radio" id="resonance-x-sin" name="resonance-x" value="sin">sin</label>
                <label for="impulse-x-tan"><input type="radio" id="impulse-x-tan" name="impulse-x" value="tan">tan</label>
                <label for="resonance-x-acos"><input type="radio" id="resonance-x-acos" name="resonance-x" value="acos">acos</label>
                <label for="resonance-x-asin"><input type="radio" id="resonance-x-asin" name="resonance-x" value="asin">asin</label>
                <label for="resonance-x-atan"><input type="radio" id="resonance-x-atan" name="resonance-x" value="atan">atan</label>
            </div>
        </fieldset>

        <fieldset class="c-function-fieldset" data-function="resonance-y">
            <legend class="c-function-legend" id="legend-resonance-y">Resonance Y</legend>
            <div class="c-function-grid" role="radiogroup" aria-labelledby="legend-resonance-y">
                <label for="resonance-y-cos"><input type="radio" id="resonance-y-cos" name="resonance-y" value="cos">cos</label>
                <label for="resonance-y-sin"><input type="radio" id="resonance-y-sin" name="resonance-y" value="sin">sin</label>
                <label for="resonance-y-tan"><input type="radio" id="resonance-y-tan" name="resonance-y" value="tan">tan</label>
                <label for="resonance-y-acos"><input type="radio" id="resonance-y-acos" name="resonance-y" value="acos">acos</label>
                <label for="resonance-y-asin"><input type="radio" id="resonance-y-asin" name="resonance-y" value="asin">asin</label>
                <label for="resonance-y-atan"><input type="radio" id="resonance-y-atan" name="resonance-y" value="atan">atan</label>
            </div>
        </fieldset>

        <fieldset class="c-function-fieldset" data-function="impulse-y">
            <legend class="c-function-legend" id="legend-impulse-y">Impulse Y</legend>
            <div class="c-function-grid" role="radiogroup" aria-labelledby="legend-impulse-y">
                <label for="impulse-y-cos"><input type="radio" id="impulse-y-cos" name="impulse-y" value="cos">cos</label>
                <label for="impulse-y-sin"><input type="radio" id="impulse-y-sin" name="impulse-y" value="sin">sin</label>
                <label for="impulse-y-tan"><input type="radio" id="impulse-y-tan" name="impulse-y" value="tan">tan</label>
                <label for="impulse-y-acos"><input type="radio" id="impulse-y-acos" name="impulse-y" value="acos">acos</label>
                <label for="impulse-y-asin"><input type="radio" id="impulse-y-asin" name="impulse-y" value="asin">asin</label>
                <label for="impulse-y-atan"><input type="radio" id="impulse-y-atan" name="impulse-y" value="atan">atan</label>
            </div>
        </fieldset>
    </header>

    <main id="main-content" class="l-organism-container" aria-label="Interactive particle animation">
        <div class="l-organism-wrapper js-organism" style="--n:1080" role="img" aria-label="Mathematical organism animation with 1080 particles">
            <!-- Particles generated by JavaScript -->
        </div>
    </main>

    <footer class="l-footer" role="contentinfo" aria-label="Animation parameter controls">
        <fieldset class="c-control-fieldset">
            <legend class="u-visually-hidden">Animation Parameters</legend>

            <div class="c-control-group">
                <div class="c-control-header">
                    <label for="js-size" class="c-control-label">Cell Size</label>
                    <output id="js-size-value" class="c-control-value" for="js-size" aria-live="polite" role="status" aria-label="Current cell size value"></output>
                </div>
                <input type="range" id="js-size" class="c-range-input c-control-input js-range-input" min="0.5" max="8" step="0.1" value="2.5" aria-describedby="js-size-value" aria-valuenow="2.5" aria-valuemin="0.5" aria-valuemax="8" aria-label="Adjust the visual size of individual particles in the organism">
            </div>

            <div class="c-control-group">
                <div class="c-control-header">
                    <label for="js-canvas" class="c-control-label">Territory</label>
                    <output id="js-canvas-value" class="c-control-value" for="js-canvas" aria-live="polite" role="status" aria-label="Current territory value"></output>
                </div>
                <input type="range" id="js-canvas" class="c-range-input c-control-input js-range-input" min="20" max="300" step="10" value="120" aria-describedby="js-canvas-value" aria-valuenow="120" aria-valuemin="20" aria-valuemax="300" aria-label="Control the movement area and spread of the organism animation">
            </div>

            <div class="c-control-group">
                <div class="c-control-header">
                    <label for="js-circulation" class="c-control-label">Diffusion</label>
                    <output id="js-circulation-value" class="c-control-value" for="js-circulation" aria-live="polite" role="status" aria-label="Current diffusion value"></output>
                </div>
                <input type="range" id="js-circulation" class="c-range-input c-control-input js-range-input" min="0" max="1440" step="30" value="720" aria-describedby="js-circulation-value" aria-valuenow="720" aria-valuemin="0" aria-valuemax="1440" aria-label="Adjust the rotational flow and angular distribution of particles">
            </div>

            <div class="c-control-group">
                <div class="c-control-header">
                    <label for="js-mutation" class="c-control-label">Mutation</label>
                    <output id="js-mutation-value" class="c-control-value" for="js-mutation" aria-live="polite" role="status" aria-label="Current mutation value"></output>
                </div>
                <input type="range" id="js-mutation" class="c-range-input c-control-input js-range-input" min="1" max="90" step="1" value="18" aria-describedby="js-mutation-value" aria-valuenow="18" aria-valuemin="1" aria-valuemax="90" aria-label="Control the variation and deviation in particle movement patterns">
            </div>

            <div class="c-control-group">
                <div class="c-control-header">
                    <label for="js-metabolism" class="c-control-label">Metabolism</label>
                    <output id="js-metabolism-value" class="c-control-value" for="js-metabolism" aria-live="polite" role="status" aria-label="Current metabolism value"></output>
                </div>
                <input type="range" id="js-metabolism" class="c-range-input c-control-input js-range-input" min="1" max="20" step="0.5" value="12" aria-describedby="js-metabolism-value" aria-valuenow="12" aria-valuemin="1" aria-valuemax="20" aria-label="Adjust the speed and duration of the animation cycle">
            </div>
        </fieldset>
    </footer>
  <script>const CONSTANTS={PARTICLE_COUNT:1080,ANNOUNCEMENT_THROTTLE:2e3,PI:Math.PI,PI_180:Math.PI/180,DEFAULT_VALUES:{size:2.5,canvas:120,circulation:720,mutation:18,metabolism:12}},DEBUG=!1;function debugLog(...e){DEBUG&&console.log("[Organism]",...e)}function measurePerformance(e,t){return function(...n){const a=performance.now();try{const o=e.apply(this,n),r=performance.now();return debugLog(`${t} took ${(r-a).toFixed(2)}ms`),o}catch(e){throw console.error(`Error in ${t}:`,e),e}}}class LiveRegionManager{constructor(){this.liveRegion=document.getElementById("js-live-region"),this.lastAnnouncement="",this.lastAnnouncementTime=0}announce(e,t=!1){const n=Date.now();(t||e!==this.lastAnnouncement&&n-this.lastAnnouncementTime>=CONSTANTS.ANNOUNCEMENT_THROTTLE)&&(this.liveRegion.textContent=e,this.lastAnnouncement=e,this.lastAnnouncementTime=n)}}class OrganismState{constructor(){this.state={},this.urlStateManager=new URLStateManager}save(){const e={functions:this.getFunctionSelections(),parameters:this.getParameterValues(),timestamp:Date.now()};try{this.urlStateManager.saveToURL(e),debugLog("State saved to URL")}catch(e){debugLog("Failed to save state to URL:",e)}}load(){const e=this.urlStateManager.loadFromURL();return!!e&&(this.applyState(e),debugLog("State loaded from URL"),!0)}getFunctionSelections(){return{impulseX:document.querySelector('input[name="impulse-x"]:checked')?.value??"sin",impulseY:document.querySelector('input[name="impulse-y"]:checked')?.value??"cos",resonanceX:document.querySelector('input[name="resonance-x"]:checked')?.value??"sin",resonanceY:document.querySelector('input[name="resonance-y"]:checked')?.value??"cos"}}getParameterValues(){const e={};return Object.keys(this.controls).forEach((t=>{e[t]=parseFloat(this.controls[t].value)})),e}applyState(e){if(e.functions){const t={impulseX:"impulse-x",impulseY:"impulse-y",resonanceX:"resonance-x",resonanceY:"resonance-y"};Object.entries(e.functions).forEach((([e,n])=>{const a=t[e];if(a){const e=document.querySelector(`input[name="${a}"][value="${n}"]`);e&&(e.checked=!0)}}))}e.parameters&&Object.entries(e.parameters).forEach((([e,t])=>{this.controls[e]&&(this.controls[e].value=t)})),updateAnimation()}}class URLStateManager{constructor(){this.bindHashChange()}saveToURL(e){try{const t=this.createCleanHash(e);window.location.hash=t}catch(e){debugLog("Failed to save to URL:",e)}}loadFromURL(){try{const e=window.location.hash.slice(1);return e?this.parseCleanHash(e):null}catch(e){return debugLog("Failed to load from URL:",e),null}}createCleanHash(e){const{functions:t,parameters:n}=e,a={impulseX:"IX",impulseY:"IY",resonanceX:"RX",resonanceY:"RY"},o={size:"CS",canvas:"T",circulation:"C",mutation:"M",metabolism:"MB"};let r="";return Object.entries(t).forEach((([e,t])=>{const n=a[e];n&&(r+=n+t)})),Object.entries(n).forEach((([e,t])=>{const n=o[e];if(n){const e=Math.round(10*t)/10;r+=n+e}})),r}parseCleanHash(e){const t={IX:"impulseX",IY:"impulseY",RX:"resonanceX",RY:"resonanceY"},n={CS:"size",T:"canvas",C:"circulation",M:"mutation",MB:"metabolism"},a={},o={};let r=0;for(;r<e.length;){if(r+2<=e.length){const n=e.substring(r,r+2);if(t[n]){let o="",s=r+2;for(;s<e.length&&s<r+7&&/[a-z]/.test(e[s]);)o+=e[s],s++;if(o&&["sin","cos","tan","asin","acos","atan"].includes(o)){a[t[n]]=o,r=s;continue}}}let s=!1;for(const[t,a]of Object.entries(n))if(e.substring(r,r+t.length)===t){let n="",i=r+t.length;for(;i<e.length&&/[\d.]/.test(e[i]);)n+=e[i],i++;if(n){o[a]=parseFloat(n),r=i,s=!0;break}}s||r++}return{functions:a,parameters:o,timestamp:Date.now()}}bindHashChange(){window.addEventListener("hashchange",(()=>{const e=this.loadFromURL();e&&(organismState.applyState(e),liveRegionManager.announce("Organism loaded from shared URL"))}))}getShareableURL(){const e={functions:organismState.getFunctionSelections(),parameters:organismState.getParameterValues(),timestamp:Date.now()};return this.saveToURL(e),window.location.href}}class ParticleSystem{constructor(e,t,n){this.container=e,this.particles=[],this.generateParticles(t,n)}generateParticles(e,t){const n=document.createDocumentFragment();for(let a=1;a<=e;a++){const e=document.createElement("q");e.className=t,e.style.setProperty("--i",a),this.particles.push(e),n.appendChild(e)}this.container.appendChild(n)}regenerateParticles(e,t){this.container.innerHTML="",this.particles=[],this.generateParticles(e,t)}updatePositions(e){this.particles.forEach(((t,n)=>{const a=e[n];a&&(t.style.setProperty("--x-1",`${a.x1}px`),t.style.setProperty("--y-1",`${a.y1}px`),t.style.setProperty("--x-2",`${a.x2}px`),t.style.setProperty("--y-2",`${a.y2}px`))}))}}class MathFunctionManager{constructor(){this.functions=this.createMathFunctions()}createMathFunctions(){return{sin:e=>{try{const t=Math.sin(e);return isFinite(t)?t:0}catch(e){return debugLog("Math.sin error:",e),0}},cos:e=>{try{const t=Math.cos(e);return isFinite(t)?t:0}catch(e){return debugLog("Math.cos error:",e),0}},tan:e=>{try{const t=Math.tan(e);return isFinite(t)?Math.max(-1e3,Math.min(1e3,t)):0}catch(e){return debugLog("Math.tan error:",e),0}},asin:e=>{try{const t=Math.asin(Math.max(-1,Math.min(1,e)));return isFinite(t)?t:0}catch(e){return debugLog("Math.asin error:",e),0}},acos:e=>{try{const t=Math.acos(Math.max(-1,Math.min(1,e)));return isFinite(t)?t:0}catch(e){return debugLog("Math.acos error:",e),0}},atan:e=>{try{const t=Math.atan(e);return isFinite(t)?t:0}catch(e){return debugLog("Math.atan error:",e),0}}}}getFunction(e){return this.functions[e]??this.functions.sin}}class ControlManager{constructor(){this.controls={},this.outputs={},this.init()}init(){this.buildControls(),this.bindEvents()}buildControls(){document.querySelectorAll(".js-range-input").forEach((e=>{this.controls[e.id.replace("js-","")]=e})),document.querySelectorAll(".c-control-value").forEach((e=>{this.outputs[e.id.replace("js-","").replace("-value","")]=e}))}bindEvents(){let e;Object.values(this.controls).forEach((t=>{t.addEventListener("input",(()=>{cancelAnimationFrame(e),e=requestAnimationFrame((()=>{updateAnimation(),organismState.save()}))}))})),[...document.querySelectorAll('input[name="impulse-x"]'),...document.querySelectorAll('input[name="impulse-y"]'),...document.querySelectorAll('input[name="resonance-x"]'),...document.querySelectorAll('input[name="resonance-y"]')].forEach((e=>{e.addEventListener("change",(()=>{updateAnimation(),liveRegionManager.announcePatternChange(),organismState.save()}))}))}updateOutputs(){Object.keys(this.controls).forEach((e=>{const t=this.controls[e],n=this.outputs[e];n&&(n.textContent=t.value,t.setAttribute("aria-valuenow",t.value))}))}}const liveRegionManager=new LiveRegionManager,mathFunctionManager=new MathFunctionManager,controlManager=new ControlManager,organismState=new OrganismState;organismState.controls=controlManager.controls;const organism=document.querySelector(".js-organism"),mainParticleSystem=new ParticleSystem(organism,CONSTANTS.PARTICLE_COUNT,"c-particle");LiveRegionManager.prototype.announcePatternChange=function(){const e=document.querySelector('input[name="impulse-x"]:checked')?.value??"sin",t=document.querySelector('input[name="impulse-y"]:checked')?.value??"cos",n=document.querySelector('input[name="resonance-x"]:checked')?.value??"sin",a=document.querySelector('input[name="resonance-y"]:checked')?.value??"cos",o=parseFloat(controlManager.controls.circulation?.value??720),r=parseFloat(controlManager.controls.mutation?.value??18),s=parseFloat(controlManager.controls.metabolism?.value??12);let i="";i+=o<240?"tight spiral ":o<720?"flowing wave ":o<1200?"expanding circle ":"chaotic swirl ",i+=r<20?"with subtle variation":r<45?"with moderate fluctuation":r<70?"with dynamic shifts":"with wild mutations",i+=s<5?", moving slowly":s<10?", at steady pace":s<15?", pulsing rapidly":", vibrating intensely";const c=`Organism pattern shifted to ${i}. Functions: ${[e,n,a,t].join(", ")}`;this.announce(c)};const KEYBOARD_SHORTCUTS={Space:()=>randomizeParameters(),Escape:()=>{document.activeElement&&document.activeElement!==document.body&&document.activeElement.blur()}};function randomizeParameters(){const e=["cos","sin","tan","acos","asin","atan"],t=e[Math.floor(Math.random()*e.length)],n=e[Math.floor(Math.random()*e.length)],a=e[Math.floor(Math.random()*e.length)],o=e[Math.floor(Math.random()*e.length)],r=document.querySelector(`input[name="impulse-x"][value="${t}"]`),s=document.querySelector(`input[name="impulse-y"][value="${n}"]`),i=document.querySelector(`input[name="resonance-x"][value="${a}"]`),c=document.querySelector(`input[name="resonance-y"][value="${o}"]`);r&&(r.checked=!0),s&&(s.checked=!0),i&&(i.checked=!0),c&&(c.checked=!0),controlManager.controls.size.value=(7.5*Math.random()+.5).toFixed(1),controlManager.controls.canvas.value=Math.floor(280*Math.random()+20),controlManager.controls.canvas.value=10*Math.floor(controlManager.controls.canvas.value/10),controlManager.controls.circulation.value=30*Math.floor(48*Math.random()+1),controlManager.controls.mutation.value=Math.floor(90*Math.random()+1),controlManager.controls.metabolism.value=(19*Math.random()+1).toFixed(1),updateAnimation(),liveRegionManager.announcePatternChange(),organismState.save()}const updateAnimation=measurePerformance((function(){try{controlManager.updateOutputs();const e=parseFloat(controlManager.controls.size.value),t=parseFloat(controlManager.controls.canvas.value),n=parseFloat(controlManager.controls.circulation.value)*CONSTANTS.PI_180,a=parseFloat(controlManager.controls.mutation.value),o=parseFloat(controlManager.controls.metabolism.value),r=document.querySelector('input[name="impulse-x"]:checked'),s=document.querySelector('input[name="impulse-y"]:checked'),i=document.querySelector('input[name="resonance-x"]:checked'),c=document.querySelector('input[name="resonance-y"]:checked'),l=r?mathFunctionManager.getFunction(r.value):mathFunctionManager.getFunction("sin"),u=s?mathFunctionManager.getFunction(s.value):mathFunctionManager.getFunction("cos"),m=i?mathFunctionManager.getFunction(i.value):mathFunctionManager.getFunction("sin"),h=c?mathFunctionManager.getFunction(c.value):mathFunctionManager.getFunction("cos"),g=document.documentElement;g.style.setProperty("--cell-size",e);const d=getComputedStyle(g).getPropertyValue("--metabolism-offset").trim()-o;g.style.setProperty("--organism-duration",`${d}s`);const p=[];for(let e=1;e<=CONSTANTS.PARTICLE_COUNT;e++){const o=a*e*CONSTANTS.PI_180,r=e*n/CONSTANTS.PARTICLE_COUNT;let s=l(o)*t,i=u(o)*t,c=m(r)*t,d=h(r)*t;const M=t*parseInt(getComputedStyle(g).getPropertyValue("--canvas-multiplier").trim());s=isFinite(s)?Math.max(-M,Math.min(M,s)):0,i=isFinite(i)?Math.max(-M,Math.min(M,i)):0,c=isFinite(c)?Math.max(-M,Math.min(M,c)):0,d=isFinite(d)?Math.max(-M,Math.min(M,d)):0,p.push({x1:s,y1:i,x2:c,y2:d})}mainParticleSystem.updatePositions(p)}catch(e){console.error("Animation update error:",e);const t=document.documentElement;t.style.setProperty("--cell-size",CONSTANTS.DEFAULT_VALUES.size),t.style.setProperty("--organism-duration","7s")}}),"updateAnimation");document.addEventListener("keydown",(e=>{if(KEYBOARD_SHORTCUTS[e.code]&&!e.target.matches("input, button, a")&&(e.preventDefault(),KEYBOARD_SHORTCUTS[e.code]()),e.target.matches('input[type="range"]')){const t=e.target.step||1,n=parseFloat(e.target.value);if("ArrowUp"===e.code||"ArrowRight"===e.code){e.preventDefault();const a=Math.min(parseFloat(e.target.max),n+parseFloat(t));e.target.value=a,e.target.setAttribute("aria-valuenow",a),updateAnimation()}else if("ArrowDown"===e.code||"ArrowLeft"===e.code){e.preventDefault();const a=Math.max(parseFloat(e.target.min),n-parseFloat(t));e.target.value=a,e.target.setAttribute("aria-valuenow",a),updateAnimation()}}}));const randomizeButton=document.querySelector(".js-randomize");randomizeButton?randomizeButton.addEventListener("click",(e=>{e.preventDefault(),randomizeParameters()})):console.error("Randomize button not found");try{debugLog("Organism initializing...");organismState.load()||randomizeParameters(),debugLog("Organism initialization complete")}catch(e){console.error("Failed to initialize organism:",e),updateAnimation()}</script></body></html>
