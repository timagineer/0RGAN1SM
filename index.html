<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>0RGAN1SM</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Syne+Mono&display=swap" rel="stylesheet">
    <style>
        @layer config, reset, base, layout, components, utilities;

        @layer config {

            :root {
                /* Colors */
                --color-bg-primary: oklch(12% 0.03 275);
                --color-fg-primary: oklch(95% 0.01 280);
                --color-fg-secondary: oklch(70% 0.02 275);
                --color-border: oklch(40% 0.015 275);
                --color-accent: oklch(65% 0.22 265);
                --color-track: oklch(25% 0.01 270);
                --color-shadow-dark: oklch(12% 0.03 275 / 0.8);
                --color-shadow-medium: oklch(12% 0.03 275 / 0.6);
                --color-border-subtle: oklch(40% 0.015 275 / 0.1);

                /* Spacing */
                --space-2xs: 0.125rem;
                --space-xs: 0.25rem;
                --space-sm: 0.375rem;
                --space-md: 0.5rem;
                --space-lg: 0.75rem;
                --space-xl: 1rem;
                --space-xs-md: clamp(0.25rem, 0.1786rem + 0.3571vw, 0.5rem);
                --space-lg-xl: clamp(0.75rem, 0.6786rem + 0.3571vw, 1rem);

                /* Typography */
                --font-size-s: clamp(0.6875rem, 0.6696rem + 0.0893vw, 0.75rem);
                --font-size-m: clamp(0.75rem, 0.7321rem + 0.0893vw, 0.8125rem);
                --font-size-l: clamp(1.875rem, 1.7679rem + 0.5357vw, 2.25rem);

                /* Borders & Radius */
                --radius-circle: 50%;
                --radius-sm: 0.25rem;
                --border-dotted: 1px dotted var(--color-border);

                /* Component Background */
                --fieldset-bg-opacity: 0.6;
                --fieldset-bg-blur: 1.5px;
                --component-bg: oklch(0.08 0 0 / var(--fieldset-bg-opacity));

                /* Easings */
                --in-circ: cubic-bezier(0.55, 0, 1, 0.45);
                --in-cubic: cubic-bezier(0.32, 0, 0.67, 0);
                --in-expo: cubic-bezier(0.7, 0, 0.84, 0);
                --in-quad: cubic-bezier(0.11, 0, 0.5, 0);
                --in-quart: cubic-bezier(0.5, 0, 0.75, 0);
                --in-quint: cubic-bezier(0.64, 0, 0.78, 0);
                --in-sine: cubic-bezier(0.12, 0, 0.39, 0);

                --in-out-back: cubic-bezier(0.68, -0.6, 0.32, 1.6);
                --in-out-circ: cubic-bezier(0.85, 0, 0.15, 1);
                --in-out-cubic: cubic-bezier(0.65, 0, 0.35, 1);
                --in-out-expo: cubic-bezier(0.87, 0, 0.13, 1);
                --in-out-quad: cubic-bezier(0.45, 0, 0.55, 1);
                --in-out-quart: cubic-bezier(0.76, 0, 0.24, 1);
                --in-out-quint: cubic-bezier(0.83, 0, 0.17, 1);
                --in-out-sine: cubic-bezier(0.37, 0, 0.63, 1);

                --out-back: cubic-bezier(0.34, 1.56, 0.64, 1);
                --out-circ: cubic-bezier(0, 0.55, 0.45, 1);
                --out-cubic: cubic-bezier(0.33, 1, 0.68, 1);
                --out-expo: cubic-bezier(0.16, 1, 0.3, 1);
                --out-quad: cubic-bezier(0.5, 1, 0.89, 1);
                --out-quart: cubic-bezier(0.25, 1, 0.5, 1);
                --out-quint: cubic-bezier(0.22, 1, 0.36, 1);
                --out-sine: cubic-bezier(0.61, 1, 0.88, 1);

                /* Animation Constants */
                --particle-count: 1080;
                --metabolism-offset: 21;
                --canvas-multiplier: 3;
            }
        }

        @layer reset {

            *,
            ::after,
            ::before {
                box-sizing: border-box;
                margin: 0;
                padding: 0;
            }
        }

        @layer base {

            html,
            body {
                accent-color: var(--color-accent);
                color: var(--color-fg-primary);
                background-color: var(--color-bg-primary);
                block-size: 100dvh;
                inline-size: 100dvw;
                font-family: "Syne Mono", ui-monospace, monospace;
                font-weight: 400;
            }

            body {
                display: flex;
                flex-direction: column;
                overflow: hidden;
            }

            input:focus {
                outline: none;
            }

            input:focus-visible {
                outline: 2px dotted var(--color-accent);
                outline-offset: 2px;
                border-radius: var(--radius-sm);
            }

            *:focus-visible {
                outline: 2px dotted var(--color-accent);
                outline-offset: 2px;
                border-radius: var(--radius-sm);
            }

            *:focus:not(:focus-visible) {
                outline: none;
            }
        }

        @layer layout {

            .l-header,
            .l-footer {
                position: relative;
                z-index: 10;
                padding: var(--space-lg-xl);
                display: flex;
                gap: var(--space-lg-xl);
                align-items: center;
                justify-content: space-evenly;
                flex-wrap: wrap;
                flex-shrink: 0;
                background-color: transparent;
            }

            @media (max-width: 768px) {
                .l-footer {
                    justify-content: center;
                }
            }

            .l-organism-container {
                flex: 1;
                display: flex;
                align-items: center;
                justify-content: center;
                min-block-size: 0;
                position: relative;
                z-index: 1;
            }

            .l-organism-wrapper {
                inline-size: fit-content;
                block-size: fit-content;
            }

            .c-function-fieldset[data-function="impulse-x"] {
                order: 1;
            }

            .c-function-fieldset[data-function="resonance-x"] {
                order: 2;
            }

            .c-function-fieldset[data-function="resonance-y"] {
                order: 3;
            }

            .c-function-fieldset[data-function="impulse-y"] {
                order: 4;
            }

            @media (min-width: 768px) {
                .c-function-fieldset[data-function="impulse-x"] {
                    order: 1;
                }

                .c-function-fieldset[data-function="resonance-x"] {
                    order: 2;
                }

                .c-title {
                    order: 3;
                }

                .c-function-fieldset[data-function="resonance-y"] {
                    order: 4;
                }

                .c-function-fieldset[data-function="impulse-y"] {
                    order: 5;
                }

                .c-function-grid {
                    grid-template-columns: repeat(3, 1fr);
                    grid-template-rows: repeat(2, 1fr);
                    grid-template-areas:
                        "cos sin tan"
                        "acos asin atan";
                }
            }

            @media (max-width: 768px) {
                .c-title {
                    order: -1;
                }

                .c-function-grid {
                    grid-template-columns: repeat(6, 1fr);
                }
            }
        }

        @layer components {

            .c-particle {
                color: oklch(80% 0.015 calc(sin(var(--hue-angle, 10) * var(--i)) * var(--hue-bend, 40) + var(--hue-base, 275)));
                background: currentColor;
                border-radius: var(--radius-circle);
                opacity: 0;
                position: absolute;
                quotes: none;
                will-change: transform;
                block-size: calc(var(--cell-size) * 0.1vmin);
                inline-size: calc(var(--cell-size) * 0.1vmin);
                --duration: var(--organism-duration, 7s);
                --delay: calc(var(--i) * var(--duration) / var(--particle-count) * 4);
                transform: translate3d(var(--x-1), var(--y-1), 0);
            }

            .c-title {
                font-size: var(--font-size-l);
                text-align: center;
                font-variant-caps: all-small-caps;
                margin: 0;
                padding-block: var(--space-md);
                flex-basis: 100%;
                text-shadow: 0 0 8px var(--color-shadow-dark);
                position: relative;
                z-index: 20;
            }

            .c-title b {
                position: relative;
                bottom: 0.55ex;
                font-size: 0.625em;
            }

            .c-title var {
                font-style: normal;
                letter-spacing: -0.15ex;
            }

            .c-title a {
                color: inherit;
                text-decoration: none;
                cursor: pointer;
                position: relative;
                display: inline-block;
                transition-duration: 780ms;
                transition-property: transform;
                transition-timing-function: var(--in-out-back);
            }

            .c-title a:hover {
                transform: scale(1.1);
                transition-duration: 300ms;
                transition-timing-function: var(--out-back);
            }

            .c-title a:focus-visible:not(:hover) {
                outline: 2px dotted var(--color-accent);
                outline-offset: 4px;
                border-radius: var(--radius-sm);
            }

            .c-title a:hover {
                outline: none;
            }

            .c-title a:active {
                outline: none;
            }

            @media (min-width: 768px) {
                .c-title {
                    flex-basis: auto;
                }
            }

            .c-function-fieldset {
                border: var(--border-dotted);
                border-radius: var(--radius-sm);
                padding-block: var(--space-md);
                padding-inline: var(--space-md);
                min-width: 0;
                background-color: var(--component-bg);
                backdrop-filter: blur(var(--fieldset-bg-blur));
                box-shadow: 0 0 0 1px var(--color-border-subtle);
                z-index: 15;
                position: relative;
            }

            .c-function-legend {
                font-weight: 500;
                color: var(--color-fg-secondary);
                font-size: var(--font-size-m);
                padding-inline: var(--space-sm);
                text-align: center;
                text-shadow: 0 0 4px var(--color-shadow-dark);
            }

            .c-function-grid {
                display: grid;
                gap: var(--space-xs-md);
                margin-block: 0;
            }

            .c-function-grid label {
                font-size: var(--font-size-s);
                color: var(--color-fg-secondary);
                cursor: pointer;
                display: flex;
                align-items: center;
                justify-content: flex-start;
                gap: 5px;
                padding-block: var(--space-2xs);
                padding-inline: var(--space-2xs);
                text-align: left;
                text-shadow: 0 0 4px var(--color-shadow-medium);
            }

            .c-function-grid input[type="radio"] {
                margin: 0;
            }

            .c-control-fieldset {
                border: none;
                padding: 0;
                margin: 0;
                display: contents;
            }

            .c-control-group {
                border: var(--border-dotted);
                border-radius: var(--radius-sm);
                padding-block: var(--space-md) var(--space-lg);
                padding-inline: var(--space-md);
                display: flex;
                flex-direction: column;
                flex: 1;
                gap: var(--space-md);
                min-inline-size: 6rem;
                max-inline-size: 8rem;
                background-color: var(--component-bg);
                backdrop-filter: blur(var(--fieldset-bg-blur));
                box-shadow: 0 0 0 1px var(--color-border-subtle);
            }

            .c-control-header {
                display: flex;
                justify-content: space-between;
                align-items: baseline;
                gap: var(--space-xs);
            }

            .c-control-label {
                font-weight: 500;
                color: var(--color-fg-secondary);
                font-size: var(--font-size-m);
                text-align: left;
                flex-shrink: 0;
                text-shadow: 0 0 4px var(--color-shadow-dark);
            }

            .c-control-value {
                text-align: right;
                font-family: ui-monospace, monospace;
                color: var(--color-fg-secondary);
                font-size: var(--font-size-s);
                flex-shrink: 0;
                text-shadow: 0 0 4px var(--color-shadow-medium);
                /* Remove focus styles for output elements */
                outline: none;
            }

            .c-control-input {
                inline-size: 100%;
                margin-block-start: var(--space-xs);
            }

            .c-range-input {
                -webkit-appearance: none;
                appearance: none;
                inline-size: 100%;
                block-size: var(--space-xs);
                border-radius: var(--radius-sm);
                background: var(--color-track);
                outline: none;
            }

            .c-range-input::-webkit-slider-runnable-track {
                background-color: var(--color-track);
                border: 1px solid var(--color-border);
                border-radius: var(--radius-sm);
                cursor: grab;
                block-size: 0.33rem;
                inline-size: 100%;
            }

            .c-range-input::-webkit-slider-thumb {
                -webkit-appearance: none;
                appearance: none;
                inline-size: var(--space-xl);
                block-size: var(--space-xl);
                border-radius: var(--radius-circle);
                background: var(--color-accent);
                border: 1px solid var(--color-border);
                cursor: grab;
                margin-block-start: calc((0.33rem - var(--space-xl)) / 2 - 1px);
            }

            .c-range-input:hover::-webkit-slider-thumb {
                border-color: var(--color-fg-secondary);
            }

            .c-range-input:focus-visible::-webkit-slider-thumb {
                background-color: var(--color-accent);
                border-color: var(--color-accent);
                outline: 2px solid transparent;
                outline-offset: 2px;
            }

            .c-range-input:not([disabled]):active::-webkit-slider-thumb {
                cursor: grabbing;
            }

            .c-range-input::-moz-range-track {
                background-color: var(--color-track);
                border: 1px solid var(--color-border);
                border-radius: var(--radius-sm);
                cursor: grab;
                block-size: 0.33rem;
                inline-size: 100%;
            }

            .c-range-input::-moz-range-thumb {
                inline-size: var(--space-xl);
                block-size: var(--space-xl);
                border-radius: var(--radius-circle);
                background: var(--color-accent);
                border: 1px solid var(--color-border);
                cursor: grab;
            }

            .c-range-input:hover::-moz-range-thumb {
                border-color: var(--color-fg-secondary);
            }

            .c-range-input:focus-visible::-moz-range-thumb {
                background-color: var(--color-accent);
                border-color: var(--color-accent);
                outline: 2px solid transparent;
                outline-offset: 2px;
            }

            .c-range-input:not([disabled]):active::-moz-range-thumb {
                cursor: grabbing;
            }

            .c-range-input::-ms-track {
                background: transparent;
                border-color: transparent;
                border-width: 0;
                color: transparent;
                cursor: grab;
                block-size: 0.33rem;
                inline-size: 100%;
            }

            .c-range-input::-ms-thumb {
                inline-size: var(--space-xl);
                block-size: var(--space-xl);
                border-radius: var(--radius-circle);
                background: var(--color-accent);
                border: 1px solid var(--color-border);
                cursor: grab;
            }

            .c-range-input:hover::-ms-thumb {
                border-color: var(--color-fg-secondary);
            }

            .c-range-input:focus-visible::-ms-thumb {
                background-color: var(--color-accent);
                border-color: var(--color-accent);
                outline: 2px solid transparent;
                outline-offset: 2px;
            }

            .c-range-input:not([disabled]):active::-ms-thumb {
                cursor: grabbing;
            }

            .c-range-input::-ms-fill-lower {
                background-color: var(--color-track);
                border: 1px solid var(--color-border);
                border-radius: var(--radius-sm);
            }

            .c-range-input::-ms-fill-upper {
                background-color: var(--color-track);
                border: 1px solid var(--color-border);
                border-radius: var(--radius-sm);
            }

            .c-range-input:focus-visible::-ms-fill-upper {
                border-color: var(--color-accent);
            }

            .c-range-input:focus-visible {
                outline: 2px dotted var(--color-accent);
                outline-offset: 2px;
                border-radius: var(--radius-sm);
            }

            .c-live-region {
                position: absolute;
                width: 1px;
                height: 1px;
                padding: 0;
                margin: -1px;
                overflow: hidden;
                clip: rect(0, 0, 0, 0);
                white-space: nowrap;
                border: 0;
            }
        }

        @layer utilities {

            .u-visually-hidden {
                position: absolute;
                inline-size: 1px;
                block-size: 1px;
                padding: 0;
                margin: -1px;
                overflow: hidden;
                clip: rect(0, 0, 0, 0);
                white-space: nowrap;
                border: 0;
            }

            .u-skip-link {
                position: absolute;
                top: -40px;
                left: 6px;
                background: var(--color-accent);
                color: var(--color-bg-primary);
                padding: 8px;
                text-decoration: none;
                border-radius: var(--radius-sm);
                z-index: 1000;
                transition: top 0.3s;
            }

            .u-skip-link:focus {
                top: 6px;
            }
        }

        @keyframes organism {
            100% {
                transform: translate3d(var(--x-2), var(--y-2), 0);
                opacity: 1;
            }
        }

        @media (prefers-reduced-motion: no-preference) {

            .c-particle {
                animation: organism var(--duration) var(--in-out-sine) var(--delay) infinite alternate;
            }
        }

        @media (prefers-reduced-motion: reduce) {

            *,
            *::before,
            *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
                scroll-behavior: auto !important;
            }
        }

        * {
            /* outline: 0.5px dotted deeppink; */
        }
    </style>
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="theme-color" content="#040511">
    <meta name="author" content="Timothy Martens">
    <meta name="description" content="Interactive mathematical organism animation with customizable parameters">
</head>

<body>
    <a href="#main-content" class="u-skip-link">Skip to main content</a>

    <div id="js-live-region" class="c-live-region" aria-live="polite" aria-atomic="true"></div>

    <header class="l-header" role="banner" aria-label="Mathematical function controls">
        <h1 class="c-title">
            <span class="u-visually-hidden">Organism</span>
            <a href="#" class="js-randomize" aria-label="Randomize organism parameters (Press spacebar anywhere to randomize)" tabindex="0">
                0rgan<var>1</var><b>sm</b>
            </a>
        </h1>

        <fieldset class="c-function-fieldset" data-function="impulse-x">
            <legend class="c-function-legend" id="legend-impulse-x">Impulse X</legend>
            <div class="c-function-grid" role="radiogroup" aria-labelledby="legend-impulse-x">
                <label for="impulse-x-cos"><input type="radio" id="impulse-x-cos" name="impulse-x" value="cos">cos</label>
                <label for="impulse-x-sin"><input type="radio" id="impulse-x-sin" name="impulse-x" value="sin">sin</label>
                <label for="impulse-x-tan"><input type="radio" id="impulse-x-tan" name="impulse-x" value="tan">tan</label>
                <label for="impulse-x-acos"><input type="radio" id="impulse-x-acos" name="impulse-x" value="acos">acos</label>
                <label for="impulse-x-asin"><input type="radio" id="impulse-x-asin" name="impulse-x" value="asin">asin</label>
                <label for="impulse-x-atan"><input type="radio" id="impulse-x-atan" name="impulse-x" value="atan">atan</label>
            </div>
        </fieldset>

        <fieldset class="c-function-fieldset" data-function="resonance-x">
            <legend class="c-function-legend" id="legend-resonance-x">Resonance X</legend>
            <div class="c-function-grid" role="radiogroup" aria-labelledby="legend-resonance-x">
                <label for="resonance-x-cos"><input type="radio" id="resonance-x-cos" name="resonance-x" value="cos">cos</label>
                <label for="resonance-x-sin"><input type="radio" id="resonance-x-sin" name="resonance-x" value="sin">sin</label>
                <label for="impulse-x-tan"><input type="radio" id="impulse-x-tan" name="impulse-x" value="tan">tan</label>
                <label for="resonance-x-acos"><input type="radio" id="resonance-x-acos" name="resonance-x" value="acos">acos</label>
                <label for="resonance-x-asin"><input type="radio" id="resonance-x-asin" name="resonance-x" value="asin">asin</label>
                <label for="resonance-x-atan"><input type="radio" id="resonance-x-atan" name="resonance-x" value="atan">atan</label>
            </div>
        </fieldset>

        <fieldset class="c-function-fieldset" data-function="resonance-y">
            <legend class="c-function-legend" id="legend-resonance-y">Resonance Y</legend>
            <div class="c-function-grid" role="radiogroup" aria-labelledby="legend-resonance-y">
                <label for="resonance-y-cos"><input type="radio" id="resonance-y-cos" name="resonance-y" value="cos">cos</label>
                <label for="resonance-y-sin"><input type="radio" id="resonance-y-sin" name="resonance-y" value="sin">sin</label>
                <label for="resonance-y-tan"><input type="radio" id="resonance-y-tan" name="resonance-y" value="tan">tan</label>
                <label for="resonance-y-acos"><input type="radio" id="resonance-y-acos" name="resonance-y" value="acos">acos</label>
                <label for="resonance-y-asin"><input type="radio" id="resonance-y-asin" name="resonance-y" value="asin">asin</label>
                <label for="resonance-y-atan"><input type="radio" id="resonance-y-atan" name="resonance-y" value="atan">atan</label>
            </div>
        </fieldset>

        <fieldset class="c-function-fieldset" data-function="impulse-y">
            <legend class="c-function-legend" id="legend-impulse-y">Impulse Y</legend>
            <div class="c-function-grid" role="radiogroup" aria-labelledby="legend-impulse-y">
                <label for="impulse-y-cos"><input type="radio" id="impulse-y-cos" name="impulse-y" value="cos">cos</label>
                <label for="impulse-y-sin"><input type="radio" id="impulse-y-sin" name="impulse-y" value="sin">sin</label>
                <label for="impulse-y-tan"><input type="radio" id="impulse-y-tan" name="impulse-y" value="tan">tan</label>
                <label for="impulse-y-acos"><input type="radio" id="impulse-y-acos" name="impulse-y" value="acos">acos</label>
                <label for="impulse-y-asin"><input type="radio" id="impulse-y-asin" name="impulse-y" value="asin">asin</label>
                <label for="impulse-y-atan"><input type="radio" id="impulse-y-atan" name="impulse-y" value="atan">atan</label>
            </div>
        </fieldset>
    </header>

    <main id="main-content" class="l-organism-container" aria-label="Interactive particle animation">
        <div class="l-organism-wrapper js-organism" style="--n:1080" role="img" aria-label="Mathematical organism animation with 1080 particles">
            <!-- Particles generated by JavaScript -->
        </div>
    </main>

    <footer class="l-footer" role="contentinfo" aria-label="Animation parameter controls">
        <fieldset class="c-control-fieldset">
            <legend class="u-visually-hidden">Animation Parameters</legend>

            <div class="c-control-group">
                <div class="c-control-header">
                    <label for="js-size" class="c-control-label">Cell Size</label>
                    <output id="js-size-value" class="c-control-value" for="js-size" aria-live="polite" role="status" aria-label="Current cell size value"></output>
                </div>
                <input type="range" id="js-size" class="c-range-input c-control-input js-range-input" min="0.5" max="8" step="0.1" value="2.5" aria-describedby="js-size-value" aria-valuenow="2.5" aria-valuemin="0.5" aria-valuemax="8" aria-label="Adjust the visual size of individual particles in the organism">
            </div>

            <div class="c-control-group">
                <div class="c-control-header">
                    <label for="js-canvas" class="c-control-label">Territory</label>
                    <output id="js-canvas-value" class="c-control-value" for="js-canvas" aria-live="polite" role="status" aria-label="Current territory value"></output>
                </div>
                <input type="range" id="js-canvas" class="c-range-input c-control-input js-range-input" min="20" max="300" step="10" value="120" aria-describedby="js-canvas-value" aria-valuenow="120" aria-valuemin="20" aria-valuemax="300" aria-label="Control the movement area and spread of the organism animation">
            </div>

            <div class="c-control-group">
                <div class="c-control-header">
                    <label for="js-circulation" class="c-control-label">Diffusion</label>
                    <output id="js-circulation-value" class="c-control-value" for="js-circulation" aria-live="polite" role="status" aria-label="Current diffusion value"></output>
                </div>
                <input type="range" id="js-circulation" class="c-range-input c-control-input js-range-input" min="0" max="1440" step="30" value="720" aria-describedby="js-circulation-value" aria-valuenow="720" aria-valuemin="0" aria-valuemax="1440" aria-label="Adjust the rotational flow and angular distribution of particles">
            </div>

            <div class="c-control-group">
                <div class="c-control-header">
                    <label for="js-mutation" class="c-control-label">Mutation</label>
                    <output id="js-mutation-value" class="c-control-value" for="js-mutation" aria-live="polite" role="status" aria-label="Current mutation value"></output>
                </div>
                <input type="range" id="js-mutation" class="c-range-input c-control-input js-range-input" min="1" max="90" step="1" value="18" aria-describedby="js-mutation-value" aria-valuenow="18" aria-valuemin="1" aria-valuemax="90" aria-label="Control the variation and deviation in particle movement patterns">
            </div>

            <div class="c-control-group">
                <div class="c-control-header">
                    <label for="js-metabolism" class="c-control-label">Metabolism</label>
                    <output id="js-metabolism-value" class="c-control-value" for="js-metabolism" aria-live="polite" role="status" aria-label="Current metabolism value"></output>
                </div>
                <input type="range" id="js-metabolism" class="c-range-input c-control-input js-range-input" min="1" max="20" step="0.5" value="12" aria-describedby="js-metabolism-value" aria-valuenow="12" aria-valuemin="1" aria-valuemax="20" aria-label="Adjust the speed and duration of the animation cycle">
            </div>
        </fieldset>
    </footer>

    <script>
        // Constants and configuration
        const CONSTANTS = {
            PARTICLE_COUNT: 1080,
            ANNOUNCEMENT_THROTTLE: 2000,
            PI: Math.PI,
            PI_180: Math.PI / 180,
            DEFAULT_VALUES: {
                size: 2.5,
                canvas: 120,
                circulation: 720,
                mutation: 18,
                metabolism: 12
            }
        };

        const DEBUG = false;

        function debugLog(...args) {
            if (DEBUG) {
                console.log('[Organism]', ...args);
            }
        }

        // Performance monitoring
        function measurePerformance(fn, name) {
            return function (...args) {
                const start = performance.now();
                try {
                    const result = fn.apply(this, args);
                    const end = performance.now();
                    debugLog(`${name} took ${(end - start).toFixed(2)}ms`);
                    return result;
                } catch (error) {
                    console.error(`Error in ${name}:`, error);
                    throw error;
                }
            };
        }

        // Live region management
        class LiveRegionManager {
            constructor() {
                this.liveRegion = document.getElementById('js-live-region');
                this.lastAnnouncement = '';
                this.lastAnnouncementTime = 0;
            }

            announce(message, force = false) {
                const now = Date.now();
                if (force || (message !== this.lastAnnouncement && now - this.lastAnnouncementTime >= CONSTANTS.ANNOUNCEMENT_THROTTLE)) {
                    this.liveRegion.textContent = message;
                    this.lastAnnouncement = message;
                    this.lastAnnouncementTime = now;
                }
            }
        }

        // State management
        class OrganismState {
            constructor() {
                this.state = {};
                this.urlStateManager = new URLStateManager();
            }

            save() {
                const state = {
                    functions: this.getFunctionSelections(),
                    parameters: this.getParameterValues(),
                    timestamp: Date.now()
                };
                try {
                    // Only save to URL hash for sharing
                    this.urlStateManager.saveToURL(state);
                    debugLog('State saved to URL');
                } catch (error) {
                    debugLog('Failed to save state to URL:', error);
                }
            }

            load() {
                // Only try to load from URL hash (for shared organisms)
                const urlState = this.urlStateManager.loadFromURL();
                if (urlState) {
                    this.applyState(urlState);
                    debugLog('State loaded from URL');
                    return true; // Indicate that state was loaded
                }
                return false; // No state loaded
            }

            getFunctionSelections() {
                return {
                    impulseX: document.querySelector('input[name="impulse-x"]:checked')?.value ?? 'sin',
                    impulseY: document.querySelector('input[name="impulse-y"]:checked')?.value ?? 'cos',
                    resonanceX: document.querySelector('input[name="resonance-x"]:checked')?.value ?? 'sin',
                    resonanceY: document.querySelector('input[name="resonance-y"]:checked')?.value ?? 'cos'
                };
            }

            getParameterValues() {
                const values = {};
                Object.keys(this.controls).forEach(key => {
                    values[key] = parseFloat(this.controls[key].value);
                });
                return values;
            }

            applyState(state) {
                if (state.functions) {
                    // Map camelCase function names to kebab-case radio button names
                    const functionNameMap = {
                        'impulseX': 'impulse-x',
                        'impulseY': 'impulse-y',
                        'resonanceX': 'resonance-x',
                        'resonanceY': 'resonance-y'
                    };

                    Object.entries(state.functions).forEach(([name, value]) => {
                        const radioName = functionNameMap[name];
                        if (radioName) {
                            const input = document.querySelector(`input[name="${radioName}"][value="${value}"]`);
                            if (input) input.checked = true;
                        }
                    });
                }
                if (state.parameters) {
                    Object.entries(state.parameters).forEach(([name, value]) => {
                        if (this.controls[name]) {
                            this.controls[name].value = value;
                        }
                    });
                }
                updateAnimation();
            }
        }

        // URL state management for sharing
        class URLStateManager {
            constructor() {
                this.bindHashChange();
            }

            saveToURL(state) {
                try {
                    const cleanHash = this.createCleanHash(state);
                    window.location.hash = cleanHash;
                } catch (error) {
                    debugLog('Failed to save to URL:', error);
                }
            }

            loadFromURL() {
                try {
                    const hash = window.location.hash.slice(1); // Remove the #
                    if (!hash) return null;

                    return this.parseCleanHash(hash);
                } catch (error) {
                    debugLog('Failed to load from URL:', error);
                    return null;
                }
            }

            createCleanHash(state) {
                const { functions, parameters } = state;

                // Function abbreviations
                const funcAbbr = {
                    'impulseX': 'IX',
                    'impulseY': 'IY',
                    'resonanceX': 'RX',
                    'resonanceY': 'RY'
                };

                // Parameter abbreviations
                const paramAbbr = {
                    'size': 'CS',
                    'canvas': 'T',
                    'circulation': 'C',
                    'mutation': 'M',
                    'metabolism': 'MB'
                };

                let hash = '';

                // Add functions
                Object.entries(functions).forEach(([name, value]) => {
                    const abbr = funcAbbr[name];
                    if (abbr) {
                        hash += abbr + value;
                    }
                });

                // Add parameters
                Object.entries(parameters).forEach(([name, value]) => {
                    const abbr = paramAbbr[name];
                    if (abbr) {
                        // Round to 1 decimal place for cleaner URLs
                        const roundedValue = Math.round(value * 10) / 10;
                        hash += abbr + roundedValue;
                    }
                });

                return hash;
            }

            parseCleanHash(hash) {
                // Function abbreviations (reverse mapping)
                const funcAbbr = {
                    'IX': 'impulseX',
                    'IY': 'impulseY',
                    'RX': 'resonanceX',
                    'RY': 'resonanceY'
                };

                // Parameter abbreviations (reverse mapping)
                const paramAbbr = {
                    'CS': 'size',
                    'T': 'canvas',
                    'C': 'circulation',
                    'M': 'mutation',
                    'MB': 'metabolism'
                };

                const functions = {};
                const parameters = {};

                // Parse the hash string
                let i = 0;
                while (i < hash.length) {
                    // Try to match function abbreviations (2 letters)
                    if (i + 2 <= hash.length) {
                        const abbr = hash.substring(i, i + 2);
                        if (funcAbbr[abbr]) {
                            // Find the function value (next 3-5 characters)
                            let value = '';
                            let j = i + 2;
                            while (j < hash.length && j < i + 7 && /[a-z]/.test(hash[j])) {
                                value += hash[j];
                                j++;
                            }
                            if (value && ['sin', 'cos', 'tan', 'asin', 'acos', 'atan'].includes(value)) {
                                functions[funcAbbr[abbr]] = value;
                                i = j;
                                continue;
                            }
                        }
                    }

                    // Try to match parameter abbreviations (1-2 letters)
                    let matched = false;
                    for (const [abbr, paramName] of Object.entries(paramAbbr)) {
                        if (hash.substring(i, i + abbr.length) === abbr) {
                            // Find the numeric value
                            let value = '';
                            let j = i + abbr.length;
                            while (j < hash.length && /[\d.]/.test(hash[j])) {
                                value += hash[j];
                                j++;
                            }
                            if (value) {
                                parameters[paramName] = parseFloat(value);
                                i = j;
                                matched = true;
                                break;
                            }
                        }
                    }

                    if (!matched) {
                        i++; // Skip unknown character
                    }
                }

                return {
                    functions,
                    parameters,
                    timestamp: Date.now()
                };
            }

            bindHashChange() {
                window.addEventListener('hashchange', () => {
                    const urlState = this.loadFromURL();
                    if (urlState) {
                        organismState.applyState(urlState);
                        liveRegionManager.announce('Organism loaded from shared URL');
                    }
                });
            }

            getShareableURL() {
                const state = {
                    functions: organismState.getFunctionSelections(),
                    parameters: organismState.getParameterValues(),
                    timestamp: Date.now()
                };
                this.saveToURL(state);
                return window.location.href;
            }
        }

        // Particle system
        class ParticleSystem {
            constructor(container, count, className) {
                this.container = container;
                this.particles = [];
                this.generateParticles(count, className);
            }

            generateParticles(count, className) {
                const fragment = document.createDocumentFragment();
                for (let i = 1; i <= count; i++) {
                    const particle = document.createElement('q');
                    particle.className = className;
                    particle.style.setProperty('--i', i);
                    this.particles.push(particle);
                    fragment.appendChild(particle);
                }
                this.container.appendChild(fragment);
            }

            regenerateParticles(count, className) {
                this.container.innerHTML = '';
                this.particles = [];
                this.generateParticles(count, className);
            }

            updatePositions(positions) {
                this.particles.forEach((particle, index) => {
                    const pos = positions[index];
                    if (pos) {
                        particle.style.setProperty('--x-1', `${pos.x1}px`);
                        particle.style.setProperty('--y-1', `${pos.y1}px`);
                        particle.style.setProperty('--x-2', `${pos.x2}px`);
                        particle.style.setProperty('--y-2', `${pos.y2}px`);
                    }
                });
            }
        }

        // Math function manager
        class MathFunctionManager {
            constructor() {
                this.functions = this.createMathFunctions();
            }

            createMathFunctions() {
                return {
                    sin: (x) => {
                        try {
                            const result = Math.sin(x);
                            return isFinite(result) ? result : 0;
                        } catch (error) {
                            debugLog('Math.sin error:', error);
                            return 0;
                        }
                    },
                    cos: (x) => {
                        try {
                            const result = Math.cos(x);
                            return isFinite(result) ? result : 0;
                        } catch (error) {
                            debugLog('Math.cos error:', error);
                            return 0;
                        }
                    },
                    tan: (x) => {
                        try {
                            const result = Math.tan(x);
                            return isFinite(result) ? Math.max(-1000, Math.min(1000, result)) : 0;
                        } catch (error) {
                            debugLog('Math.tan error:', error);
                            return 0;
                        }
                    },
                    asin: (x) => {
                        try {
                            const result = Math.asin(Math.max(-1, Math.min(1, x)));
                            return isFinite(result) ? result : 0;
                        } catch (error) {
                            debugLog('Math.asin error:', error);
                            return 0;
                        }
                    },
                    acos: (x) => {
                        try {
                            const result = Math.acos(Math.max(-1, Math.min(1, x)));
                            return isFinite(result) ? result : 0;
                        } catch (error) {
                            debugLog('Math.acos error:', error);
                            return 0;
                        }
                    },
                    atan: (x) => {
                        try {
                            const result = Math.atan(x);
                            return isFinite(result) ? result : 0;
                        } catch (error) {
                            debugLog('Math.atan error:', error);
                            return 0;
                        }
                    }
                };
            }

            getFunction(name) {
                return this.functions[name] ?? this.functions.sin;
            }
        }

        // Control manager
        class ControlManager {
            constructor() {
                this.controls = {};
                this.outputs = {};
                this.init();
            }

            init() {
                this.buildControls();
                this.bindEvents();
            }

            buildControls() {
                document.querySelectorAll('.js-range-input').forEach(input => {
                    this.controls[input.id.replace('js-', '')] = input;
                });

                document.querySelectorAll('.c-control-value').forEach(output => {
                    this.outputs[output.id.replace('js-', '').replace('-value', '')] = output;
                });
            }

            bindEvents() {
                // Performance-optimized event listeners with requestAnimationFrame
                let animationFrame;
                Object.values(this.controls).forEach(control => {
                    control.addEventListener('input', () => {
                        cancelAnimationFrame(animationFrame);
                        animationFrame = requestAnimationFrame(() => {
                            updateAnimation();
                            organismState.save();
                        });
                    });
                });

                // Function selection events
                [
                    ...document.querySelectorAll('input[name="impulse-x"]'),
                    ...document.querySelectorAll('input[name="impulse-y"]'),
                    ...document.querySelectorAll('input[name="resonance-x"]'),
                    ...document.querySelectorAll('input[name="resonance-y"]')
                ].forEach(radio => {
                    radio.addEventListener('change', () => {
                        updateAnimation();
                        liveRegionManager.announcePatternChange();
                        organismState.save();
                    });
                });
            }



            updateOutputs() {
                Object.keys(this.controls).forEach(key => {
                    const input = this.controls[key];
                    const output = this.outputs[key];
                    if (output) {
                        output.textContent = input.value;
                        input.setAttribute('aria-valuenow', input.value);
                    }
                });
            }
        }

        // Initialize instances
        const liveRegionManager = new LiveRegionManager();
        const mathFunctionManager = new MathFunctionManager();
        const controlManager = new ControlManager();
        const organismState = new OrganismState();

        // Connect organismState to controlManager
        organismState.controls = controlManager.controls;

        // Initialize particle systems
        const organism = document.querySelector('.js-organism');
        const mainParticleSystem = new ParticleSystem(organism, CONSTANTS.PARTICLE_COUNT, 'c-particle');

        // Enhanced pattern description with better live region management
        LiveRegionManager.prototype.announcePatternChange = function () {
            const impulseX = document.querySelector('input[name="impulse-x"]:checked')?.value ?? 'sin';
            const impulseY = document.querySelector('input[name="impulse-y"]:checked')?.value ?? 'cos';
            const resonanceX = document.querySelector('input[name="resonance-x"]:checked')?.value ?? 'sin';
            const resonanceY = document.querySelector('input[name="resonance-y"]:checked')?.value ?? 'cos';

            const circulation = parseFloat(controlManager.controls.circulation?.value ?? 720);
            const mutation = parseFloat(controlManager.controls.mutation?.value ?? 18);
            const metabolism = parseFloat(controlManager.controls.metabolism?.value ?? 12);

            let patternDescription = '';

            // Describe circulation pattern
            if (circulation < 240) {
                patternDescription += 'tight spiral ';
            } else if (circulation < 720) {
                patternDescription += 'flowing wave ';
            } else if (circulation < 1200) {
                patternDescription += 'expanding circle ';
            } else {
                patternDescription += 'chaotic swirl ';
            }

            // Describe mutation intensity
            if (mutation < 20) {
                patternDescription += 'with subtle variation';
            } else if (mutation < 45) {
                patternDescription += 'with moderate fluctuation';
            } else if (mutation < 70) {
                patternDescription += 'with dynamic shifts';
            } else {
                patternDescription += 'with wild mutations';
            }

            // Describe metabolism
            if (metabolism < 5) {
                patternDescription += ', moving slowly';
            } else if (metabolism < 10) {
                patternDescription += ', at steady pace';
            } else if (metabolism < 15) {
                patternDescription += ', pulsing rapidly';
            } else {
                patternDescription += ', vibrating intensely';
            }

            const announcement = `Organism pattern shifted to ${patternDescription}. Functions: ${[impulseX, resonanceX, resonanceY, impulseY].join(', ')}`;
            this.announce(announcement);
        };



        // Enhanced randomization with keyboard shortcuts
        const KEYBOARD_SHORTCUTS = {
            'Space': () => randomizeParameters(),
            'Escape': () => {
                // Clear focus from any focused element
                if (document.activeElement && document.activeElement !== document.body) {
                    document.activeElement.blur();
                }
            }
        };

        function randomizeParameters() {
            const functions = ['cos', 'sin', 'tan', 'acos', 'asin', 'atan'];

            // Randomize function selections
            const randomImpulseX = functions[Math.floor(Math.random() * functions.length)];
            const randomImpulseY = functions[Math.floor(Math.random() * functions.length)];
            const randomResonanceX = functions[Math.floor(Math.random() * functions.length)];
            const randomResonanceY = functions[Math.floor(Math.random() * functions.length)];

            // Set random functions
            const impulseXInput = document.querySelector(`input[name="impulse-x"][value="${randomImpulseX}"]`);
            const impulseYInput = document.querySelector(`input[name="impulse-y"][value="${randomImpulseY}"]`);
            const resonanceXInput = document.querySelector(`input[name="resonance-x"][value="${randomResonanceX}"]`);
            const resonanceYInput = document.querySelector(`input[name="resonance-y"][value="${randomResonanceY}"]`);

            if (impulseXInput) impulseXInput.checked = true;
            if (impulseYInput) impulseYInput.checked = true;
            if (resonanceXInput) resonanceXInput.checked = true;
            if (resonanceYInput) resonanceYInput.checked = true;

            // Randomize slider values
            controlManager.controls.size.value = (Math.random() * 7.5 + 0.5).toFixed(1);
            controlManager.controls.canvas.value = Math.floor(Math.random() * 280 + 20);
            controlManager.controls.canvas.value = Math.floor(controlManager.controls.canvas.value / 10) * 10;
            controlManager.controls.circulation.value = Math.floor(Math.random() * 48 + 1) * 30;
            controlManager.controls.mutation.value = Math.floor(Math.random() * 90 + 1);
            controlManager.controls.metabolism.value = (Math.random() * 19 + 1).toFixed(1);

            updateAnimation();
            liveRegionManager.announcePatternChange();
            organismState.save();
        }





        // Optimized main animation with performance monitoring and error handling
        const updateAnimation = measurePerformance(function () {
            try {
                controlManager.updateOutputs();

                const size = parseFloat(controlManager.controls.size.value);
                const canvas = parseFloat(controlManager.controls.canvas.value);
                const circulation = parseFloat(controlManager.controls.circulation.value) * CONSTANTS.PI_180;
                const mutation = parseFloat(controlManager.controls.mutation.value);
                const metabolismValue = parseFloat(controlManager.controls.metabolism.value);

                // Get selected functions
                const impulseXElement = document.querySelector('input[name="impulse-x"]:checked');
                const impulseYElement = document.querySelector('input[name="impulse-y"]:checked');
                const resonanceXElement = document.querySelector('input[name="resonance-x"]:checked');
                const resonanceYElement = document.querySelector('input[name="resonance-y"]:checked');

                const impulseXFunc = impulseXElement ? mathFunctionManager.getFunction(impulseXElement.value) : mathFunctionManager.getFunction('sin');
                const impulseYFunc = impulseYElement ? mathFunctionManager.getFunction(impulseYElement.value) : mathFunctionManager.getFunction('cos');
                const resonanceXFunc = resonanceXElement ? mathFunctionManager.getFunction(resonanceXElement.value) : mathFunctionManager.getFunction('sin');
                const resonanceYFunc = resonanceYElement ? mathFunctionManager.getFunction(resonanceYElement.value) : mathFunctionManager.getFunction('cos');

                // Update CSS custom properties
                const root = document.documentElement;
                root.style.setProperty('--cell-size', size);

                const actualDuration = getComputedStyle(root).getPropertyValue('--metabolism-offset').trim() - metabolismValue;
                root.style.setProperty('--organism-duration', `${actualDuration}s`);

                // Calculate positions for main particles
                const positions = [];
                for (let i = 1; i <= CONSTANTS.PARTICLE_COUNT; i++) {
                    const n = CONSTANTS.PARTICLE_COUNT;

                    const angle1 = mutation * i * CONSTANTS.PI_180;
                    const angle2 = i * circulation / n;

                    let x1 = impulseXFunc(angle1) * canvas;
                    let y1 = impulseYFunc(angle1) * canvas;
                    let x2 = resonanceXFunc(angle2) * canvas;
                    let y2 = resonanceYFunc(angle2) * canvas;

                    // Validate and clamp values
                    const canvasMultiplier = parseInt(getComputedStyle(root).getPropertyValue('--canvas-multiplier').trim());
                    const maxVal = canvas * canvasMultiplier;

                    x1 = isFinite(x1) ? Math.max(-maxVal, Math.min(maxVal, x1)) : 0;
                    y1 = isFinite(y1) ? Math.max(-maxVal, Math.min(maxVal, y1)) : 0;
                    x2 = isFinite(x2) ? Math.max(-maxVal, Math.min(maxVal, x2)) : 0;
                    y2 = isFinite(y2) ? Math.max(-maxVal, Math.min(maxVal, y2)) : 0;

                    positions.push({ x1, y1, x2, y2 });
                }

                mainParticleSystem.updatePositions(positions);
            } catch (error) {
                console.error('Animation update error:', error);
                // Fallback to safe values
                const root = document.documentElement;
                root.style.setProperty('--cell-size', CONSTANTS.DEFAULT_VALUES.size);
                root.style.setProperty('--organism-duration', '7s');
            }
        }, 'updateAnimation');

        // Enhanced keyboard navigation with shortcuts
        document.addEventListener('keydown', (e) => {
            // Handle keyboard shortcuts
            if (KEYBOARD_SHORTCUTS[e.code] && !e.target.matches('input, button, a')) {
                e.preventDefault();
                KEYBOARD_SHORTCUTS[e.code]();
            }

            // Arrow keys for fine control when range inputs are focused
            if (e.target.matches('input[type="range"]')) {
                const step = e.target.step || 1;
                const currentValue = parseFloat(e.target.value);

                if (e.code === 'ArrowUp' || e.code === 'ArrowRight') {
                    e.preventDefault();
                    const newValue = Math.min(parseFloat(e.target.max), currentValue + parseFloat(step));
                    e.target.value = newValue;
                    e.target.setAttribute('aria-valuenow', newValue);
                    updateAnimation();
                } else if (e.code === 'ArrowDown' || e.code === 'ArrowLeft') {
                    e.preventDefault();
                    const newValue = Math.max(parseFloat(e.target.min), currentValue - parseFloat(step));
                    e.target.value = newValue;
                    e.target.setAttribute('aria-valuenow', newValue);
                    updateAnimation();
                }
            }
        });

        // Click event for randomization
        const randomizeButton = document.querySelector('.js-randomize');
        if (randomizeButton) {
            randomizeButton.addEventListener('click', (e) => {
                e.preventDefault();
                randomizeParameters();
            });
        } else {
            console.error('Randomize button not found');
        }





        // Initialize
        try {
            debugLog('Organism initializing...');

            // Try to load state from URL first
            const stateLoaded = organismState.load();

            // If no state was loaded from URL, randomize
            if (!stateLoaded) {
                randomizeParameters();
            }

            debugLog('Organism initialization complete');
        } catch (error) {
            console.error('Failed to initialize organism:', error);
            // Fallback to default values
            updateAnimation();
        }
    </script>

</body>

</html>
