<!doctypehtml><html lang=en><meta charset=UTF-8><meta content="width=device-width,initial-scale=1"name=viewport><title>0RGAN1SM</title><link href=https://fonts.googleapis.com rel=preconnect><link href=https://fonts.gstatic.com rel=preconnect crossorigin><link href="https://fonts.googleapis.com/css2?family=Syne+Mono&display=swap"rel=stylesheet><style>@layer config,reset,base,layout,components,utilities; @layer config{:root{--color-bg-primary:oklch(12% 0.03 275);--color-fg-primary:oklch(95% 0.01 280);--color-fg-secondary:oklch(70% 0.02 275);--color-border:oklch(40% 0.015 275);--color-accent:oklch(65% 0.22 265);--color-track:oklch(25% 0.01 270);--color-shadow-dark:oklch(12% 0.03 275 / 0.8);--color-shadow-medium:oklch(12% 0.03 275 / 0.6);--color-border-subtle:oklch(40% 0.015 275 / 0.1);--space-2xs:0.125rem;--space-xs:0.25rem;--space-sm:0.375rem;--space-md:0.5rem;--space-lg:0.75rem;--space-xl:1rem;--space-xs-md:clamp(0.25rem, 0.1786rem + 0.3571vw, 0.5rem);--space-lg-xl:clamp(0.75rem, 0.6786rem + 0.3571vw, 1rem);--font-size-s:clamp(0.6875rem, 0.6696rem + 0.0893vw, 0.75rem);--font-size-m:clamp(0.75rem, 0.7321rem + 0.0893vw, 0.8125rem);--font-size-l:clamp(1.875rem, 1.7679rem + 0.5357vw, 2.25rem);--radius-circle:50%;--radius-sm:0.25rem;--border-dotted:1px dotted var(--color-border);--fieldset-bg-opacity:0.6;--fieldset-bg-blur:1.5px;--component-bg:oklch(0.08 0 0 / var(--fieldset-bg-opacity));--in-circ:cubic-bezier(0.55, 0, 1, 0.45);--in-cubic:cubic-bezier(0.32, 0, 0.67, 0);--in-expo:cubic-bezier(0.7, 0, 0.84, 0);--in-quad:cubic-bezier(0.11, 0, 0.5, 0);--in-quart:cubic-bezier(0.5, 0, 0.75, 0);--in-quint:cubic-bezier(0.64, 0, 0.78, 0);--in-sine:cubic-bezier(0.12, 0, 0.39, 0);--in-out-back:cubic-bezier(0.68, -0.6, 0.32, 1.6);--in-out-circ:cubic-bezier(0.85, 0, 0.15, 1);--in-out-cubic:cubic-bezier(0.65, 0, 0.35, 1);--in-out-expo:cubic-bezier(0.87, 0, 0.13, 1);--in-out-quad:cubic-bezier(0.45, 0, 0.55, 1);--in-out-quart:cubic-bezier(0.76, 0, 0.24, 1);--in-out-quint:cubic-bezier(0.83, 0, 0.17, 1);--in-out-sine:cubic-bezier(0.37, 0, 0.63, 1);--out-back:cubic-bezier(0.34, 1.56, 0.64, 1);--out-circ:cubic-bezier(0, 0.55, 0.45, 1);--out-cubic:cubic-bezier(0.33, 1, 0.68, 1);--out-expo:cubic-bezier(0.16, 1, 0.3, 1);--out-quad:cubic-bezier(0.5, 1, 0.89, 1);--out-quart:cubic-bezier(0.25, 1, 0.5, 1);--out-quint:cubic-bezier(0.22, 1, 0.36, 1);--out-sine:cubic-bezier(0.61, 1, 0.88, 1);--particle-count:1080;--metabolism-offset:21;--canvas-multiplier:3}}@layer reset{*,::after,::before{box-sizing:border-box;margin:0;padding:0}}@layer base{body,html{accent-color:var(--color-accent);color:var(--color-fg-primary);background-color:var(--color-bg-primary);block-size:100dvh;inline-size:100dvw;font-family:"Syne Mono",ui-monospace,monospace;font-weight:400}body{display:flex;flex-direction:column;overflow:hidden}:focus:not(:focus-visible),input:focus{outline:0}input:focus-visible{outline:2px dotted var(--color-accent);outline-offset:2px;border-radius:var(--radius-sm)}:focus-visible{outline:2px dotted var(--color-accent);outline-offset:2px;border-radius:var(--radius-sm)}}@layer layout{.l-footer,.l-header{position:relative;z-index:10;padding:var(--space-lg-xl);display:flex;gap:var(--space-lg-xl);align-items:center;justify-content:space-evenly;flex-wrap:wrap;flex-shrink:0;background-color:transparent}.l-organism-container{flex:1;display:flex;align-items:center;justify-content:center;min-block-size:0;position:relative;z-index:1}.l-organism-wrapper{inline-size:fit-content;block-size:fit-content}.c-function-fieldset[data-function=impulse-x]{order:1}.c-function-fieldset[data-function=resonance-x]{order:2}.c-function-fieldset[data-function=resonance-y]{order:3}.c-function-fieldset[data-function=impulse-y]{order:4}@media (min-width:768px){.c-function-fieldset[data-function=impulse-x]{order:1}.c-function-fieldset[data-function=resonance-x]{order:2}.c-title{order:3}.c-function-fieldset[data-function=resonance-y]{order:4}.c-function-fieldset[data-function=impulse-y]{order:5}.c-function-grid{grid-template-columns:repeat(3,1fr);grid-template-rows:repeat(2,1fr);grid-template-areas:"cos sin tan" "acos asin atan"}}@media (max-width:768px){.l-footer{justify-content:center}.c-title{order:-1}.c-function-grid{grid-template-columns:repeat(6,1fr)}}}@layer components{.c-function-fieldset,.c-title{padding-block:var(--space-md)}.c-function-grid input[type=radio],.c-title{margin:0}.c-particle{color:oklch(80% .015 calc(sin(var(--hue-angle,10) * var(--i)) * var(--hue-bend,40) + var(--hue-base,275)));background:currentColor;border-radius:var(--radius-circle);opacity:0;position:absolute;quotes:none;will-change:transform;block-size:calc(var(--cell-size) * 0.1vmin);inline-size:calc(var(--cell-size) * 0.1vmin);--duration:var(--organism-duration, 7s);--delay:calc(var(--i) * var(--duration) / var(--particle-count) * 4);transform:translate3d(var(--x-1),var(--y-1),0)}.c-control-group,.c-function-fieldset{background-color:var(--component-bg);backdrop-filter:blur(var(--fieldset-bg-blur));box-shadow:0 0 0 1px var(--color-border-subtle)}.c-title,.c-title a,.c-title b{position:relative}.c-title{font-size:var(--font-size-l);text-align:center;font-variant-caps:all-small-caps;flex-basis:100%;text-shadow:0 0 8px var(--color-shadow-dark);z-index:20}.c-control-label,.c-function-legend{font-weight:500;font-size:var(--font-size-m);text-shadow:0 0 4px var(--color-shadow-dark)}.c-title b{bottom:.55ex;font-size:.625em}.c-title var{font-style:normal;letter-spacing:-.15ex}.c-title a{color:inherit;text-decoration:none;cursor:pointer;display:inline-block;transition-duration:780ms;transition-property:transform;transition-timing-function:var(--in-out-back)}.c-title a:hover{transform:scale(1.1);transition-duration:.3s;transition-timing-function:var(--out-back)}.c-title a:focus-visible:not(:hover){outline:2px dotted var(--color-accent);outline-offset:4px;border-radius:var(--radius-sm)}.c-title a:active,.c-title a:hover{outline:0}@media (min-width:768px){.c-title{flex-basis:auto}}.c-function-fieldset{border:var(--border-dotted);border-radius:var(--radius-sm);padding-inline:var(--space-md);min-width:0;z-index:15;position:relative}.c-function-legend{color:var(--color-fg-secondary);padding-inline:var(--space-sm);text-align:center}.c-control-label,.c-function-grid label{text-align:left;color:var(--color-fg-secondary)}.c-function-grid{display:grid;gap:var(--space-xs-md);margin-block:0}.c-function-grid label{font-size:var(--font-size-s);cursor:pointer;display:flex;align-items:center;justify-content:flex-start;gap:5px;padding-block:var(--space-2xs);padding-inline:var(--space-2xs);text-shadow:0 0 4px var(--color-shadow-medium)}.c-control-fieldset{border:none;padding:0;margin:0;display:contents}.c-control-group{border:var(--border-dotted);border-radius:var(--radius-sm);padding-block:var(--space-md) var(--space-lg);padding-inline:var(--space-md);display:flex;flex-direction:column;flex:1;gap:var(--space-md);min-inline-size:6rem;max-inline-size:8rem}.c-control-header{display:flex;justify-content:space-between;align-items:baseline;gap:var(--space-xs)}.c-control-label{flex-shrink:0}.c-control-value{text-align:right;font-family:ui-monospace,monospace;color:var(--color-fg-secondary);font-size:var(--font-size-s);flex-shrink:0;text-shadow:0 0 4px var(--color-shadow-medium);outline:0}.c-control-input{inline-size:100%;margin-block-start:var(--space-xs)}.c-range-input{-webkit-appearance:none;appearance:none;inline-size:100%;block-size:var(--space-xs);border-radius:var(--radius-sm);background:var(--color-track);outline:0}.c-range-input::-webkit-slider-runnable-track{background-color:var(--color-track);border:1px solid var(--color-border);border-radius:var(--radius-sm);cursor:grab;block-size:0.33rem;inline-size:100%}.c-range-input::-webkit-slider-thumb{-webkit-appearance:none;appearance:none;inline-size:var(--space-xl);block-size:var(--space-xl);border-radius:var(--radius-circle);background:var(--color-accent);border:1px solid var(--color-border);cursor:grab;margin-block-start:calc((0.33rem - var(--space-xl))/ 2 - 1px)}.c-range-input:hover::-webkit-slider-thumb{border-color:var(--color-fg-secondary)}.c-range-input:focus-visible::-webkit-slider-thumb{background-color:var(--color-accent);border-color:var(--color-accent);outline:transparent solid 2px;outline-offset:2px}.c-range-input:not([disabled]):active::-webkit-slider-thumb{cursor:grabbing}.c-range-input::-moz-range-track{background-color:var(--color-track);border:1px solid var(--color-border);border-radius:var(--radius-sm);cursor:grab;block-size:0.33rem;inline-size:100%}.c-range-input::-moz-range-thumb{inline-size:var(--space-xl);block-size:var(--space-xl);border-radius:var(--radius-circle);background:var(--color-accent);border:1px solid var(--color-border);cursor:grab}.c-range-input:hover::-moz-range-thumb{border-color:var(--color-fg-secondary)}.c-range-input:focus-visible::-moz-range-thumb{background-color:var(--color-accent);border-color:var(--color-accent);outline:transparent solid 2px;outline-offset:2px}.c-range-input:not([disabled]):active::-moz-range-thumb{cursor:grabbing}.c-range-input::-ms-track{background:0 0;border-color:transparent;border-width:0;color:transparent;cursor:grab;block-size:0.33rem;inline-size:100%}.c-range-input::-ms-thumb{inline-size:var(--space-xl);block-size:var(--space-xl);border-radius:var(--radius-circle);background:var(--color-accent);border:1px solid var(--color-border);cursor:grab}.c-range-input:hover::-ms-thumb{border-color:var(--color-fg-secondary)}.c-range-input:focus-visible::-ms-thumb{background-color:var(--color-accent);border-color:var(--color-accent);outline:transparent solid 2px;outline-offset:2px}.c-range-input:not([disabled]):active::-ms-thumb{cursor:grabbing}.c-range-input::-ms-fill-lower{background-color:var(--color-track);border:1px solid var(--color-border);border-radius:var(--radius-sm)}.c-range-input::-ms-fill-upper{background-color:var(--color-track);border:1px solid var(--color-border);border-radius:var(--radius-sm)}.c-range-input:focus-visible::-ms-fill-upper{border-color:var(--color-accent)}.c-range-input:focus-visible{outline:2px dotted var(--color-accent);outline-offset:2px;border-radius:var(--radius-sm)}.c-live-region{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}}@layer utilities{.u-visually-hidden{position:absolute;inline-size:1px;block-size:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}.u-skip-link{position:absolute;top:-40px;left:6px;background:var(--color-accent);color:var(--color-bg-primary);padding:8px;text-decoration:none;border-radius:var(--radius-sm);z-index:1000;transition:top .3s}.u-skip-link:focus{top:6px}}@keyframes organism{100%{transform:translate3d(var(--x-2),var(--y-2),0);opacity:1}}@media (prefers-reduced-motion:no-preference){.c-particle{animation:organism var(--duration) var(--in-out-sine) var(--delay) infinite alternate}}@media (prefers-reduced-motion:reduce){*,::after,::before{animation-duration:0s!important;animation-iteration-count:1!important;transition-duration:0s!important;scroll-behavior:auto!important}}</style><meta content=yes name=mobile-web-app-capable><meta content=black name=apple-mobile-web-app-status-bar-style><meta content=#040511 name=theme-color><meta content="Timothy Martens"name=author><meta content="Interactive mathematical organism animation with customizable parameters"name=description><a class=u-skip-link href=#main-content>Skip to main content</a><div class=c-live-region aria-atomic=true aria-live=polite id=js-live-region></div><header aria-label="Mathematical function controls"class=l-header role=banner><h1 class=c-title><span class=u-visually-hidden>Organism</span> <a class=js-randomize href=# aria-label="Randomize organism parameters (Press spacebar anywhere to randomize)"tabindex=0>0rgan<var>1</var><b>sm</b></a></h1><fieldset class=c-function-fieldset data-function=impulse-x><legend class=c-function-legend id=legend-impulse-x>Impulse X</legend><div class=c-function-grid role=radiogroup aria-labelledby=legend-impulse-x><label for=impulse-x-cos><input id=impulse-x-cos type=radio value=cos name=impulse-x>cos</label> <label for=impulse-x-sin><input id=impulse-x-sin type=radio value=sin name=impulse-x>sin</label> <label for=impulse-x-tan><input id=impulse-x-tan type=radio value=tan name=impulse-x>tan</label> <label for=impulse-x-acos><input id=impulse-x-acos type=radio value=acos name=impulse-x>acos</label> <label for=impulse-x-asin><input id=impulse-x-asin type=radio value=asin name=impulse-x>asin</label> <label for=impulse-x-atan><input id=impulse-x-atan type=radio value=atan name=impulse-x>atan</label></div></fieldset><fieldset class=c-function-fieldset data-function=resonance-x><legend class=c-function-legend id=legend-resonance-x>Resonance X</legend><div class=c-function-grid role=radiogroup aria-labelledby=legend-resonance-x><label for=resonance-x-cos><input id=resonance-x-cos type=radio value=cos name=resonance-x>cos</label> <label for=resonance-x-sin><input id=resonance-x-sin type=radio value=sin name=resonance-x>sin</label> <label for=impulse-x-tan><input id=impulse-x-tan type=radio value=tan name=impulse-x>tan</label> <label for=resonance-x-acos><input id=resonance-x-acos type=radio value=acos name=resonance-x>acos</label> <label for=resonance-x-asin><input id=resonance-x-asin type=radio value=asin name=resonance-x>asin</label> <label for=resonance-x-atan><input id=resonance-x-atan type=radio value=atan name=resonance-x>atan</label></div></fieldset><fieldset class=c-function-fieldset data-function=resonance-y><legend class=c-function-legend id=legend-resonance-y>Resonance Y</legend><div class=c-function-grid role=radiogroup aria-labelledby=legend-resonance-y><label for=resonance-y-cos><input id=resonance-y-cos type=radio value=cos name=resonance-y>cos</label> <label for=resonance-y-sin><input id=resonance-y-sin type=radio value=sin name=resonance-y>sin</label> <label for=resonance-y-tan><input id=resonance-y-tan type=radio value=tan name=resonance-y>tan</label> <label for=resonance-y-acos><input id=resonance-y-acos type=radio value=acos name=resonance-y>acos</label> <label for=resonance-y-asin><input id=resonance-y-asin type=radio value=asin name=resonance-y>asin</label> <label for=resonance-y-atan><input id=resonance-y-atan type=radio value=atan name=resonance-y>atan</label></div></fieldset><fieldset class=c-function-fieldset data-function=impulse-y><legend class=c-function-legend id=legend-impulse-y>Impulse Y</legend><div class=c-function-grid role=radiogroup aria-labelledby=legend-impulse-y><label for=impulse-y-cos><input id=impulse-y-cos type=radio value=cos name=impulse-y>cos</label> <label for=impulse-y-sin><input id=impulse-y-sin type=radio value=sin name=impulse-y>sin</label> <label for=impulse-y-tan><input id=impulse-y-tan type=radio value=tan name=impulse-y>tan</label> <label for=impulse-y-acos><input id=impulse-y-acos type=radio value=acos name=impulse-y>acos</label> <label for=impulse-y-asin><input id=impulse-y-asin type=radio value=asin name=impulse-y>asin</label> <label for=impulse-y-atan><input id=impulse-y-atan type=radio value=atan name=impulse-y>atan</label></div></fieldset></header><main aria-label="Interactive particle animation"class=l-organism-container id=main-content><div class="js-organism l-organism-wrapper"role=img aria-label="Mathematical organism animation with 1080 particles"style=--n:1080></div></main><footer aria-label="Animation parameter controls"class=l-footer role=contentinfo><fieldset class=c-control-fieldset><legend class=u-visually-hidden>Animation Parameters</legend><div class=c-control-group><div class=c-control-header><label for=js-size class=c-control-label>Cell Size</label><output aria-label="Current cell size value"aria-live=polite class=c-control-value for=js-size id=js-size-value role=status></output></div><input id=js-size type=range value=2.5 aria-describedby=js-size-value aria-label="Adjust the visual size of individual particles in the organism"aria-valuemax=8 aria-valuemin=0.5 aria-valuenow=2.5 class="c-control-input c-range-input js-range-input"max=8 min=0.5 step=0.1></div><div class=c-control-group><div class=c-control-header><label for=js-canvas class=c-control-label>Territory</label><output aria-label="Current territory value"aria-live=polite class=c-control-value for=js-canvas id=js-canvas-value role=status></output></div><input id=js-canvas type=range value=120 aria-describedby=js-canvas-value aria-label="Control the movement area and spread of the organism animation"aria-valuemax=300 aria-valuemin=20 aria-valuenow=120 class="c-control-input c-range-input js-range-input"max=300 min=20 step=10></div><div class=c-control-group><div class=c-control-header><label for=js-circulation class=c-control-label>Diffusion</label><output aria-label="Current diffusion value"aria-live=polite class=c-control-value for=js-circulation id=js-circulation-value role=status></output></div><input id=js-circulation type=range value=720 aria-describedby=js-circulation-value aria-label="Adjust the rotational flow and angular distribution of particles"aria-valuemax=1440 aria-valuemin=0 aria-valuenow=720 class="c-control-input c-range-input js-range-input"max=1440 min=0 step=30></div><div class=c-control-group><div class=c-control-header><label for=js-mutation class=c-control-label>Mutation</label><output aria-label="Current mutation value"aria-live=polite class=c-control-value for=js-mutation id=js-mutation-value role=status></output></div><input id=js-mutation type=range value=18 aria-describedby=js-mutation-value aria-label="Control the variation and deviation in particle movement patterns"aria-valuemax=90 aria-valuemin=1 aria-valuenow=18 class="c-control-input c-range-input js-range-input"max=90 min=1 step=1></div><div class=c-control-group><div class=c-control-header><label for=js-metabolism class=c-control-label>Metabolism</label><output aria-label="Current metabolism value"aria-live=polite class=c-control-value for=js-metabolism id=js-metabolism-value role=status></output></div><input id=js-metabolism type=range value=12 aria-describedby=js-metabolism-value aria-label="Adjust the speed and duration of the animation cycle"aria-valuemax=20 aria-valuemin=1 aria-valuenow=12 class="c-control-input c-range-input js-range-input"max=20 min=1 step=0.5></div></fieldset></footer><script>const CONSTANTS={PARTICLE_COUNT:1080,ANNOUNCEMENT_THROTTLE:2e3,PI:Math.PI,PI_180:Math.PI/180,DEFAULT_VALUES:{size:2.5,canvas:120,circulation:720,mutation:18,metabolism:12}},DEBUG=!1;function debugLog(...e){DEBUG&&console.log("[Organism]",...e)}function measurePerformance(e,t){return function(...n){const a=performance.now();try{const o=e.apply(this,n),r=performance.now();return debugLog(`${t} took ${(r-a).toFixed(2)}ms`),o}catch(e){throw console.error(`Error in ${t}:`,e),e}}}class LiveRegionManager{constructor(){this.liveRegion=document.getElementById("js-live-region"),this.lastAnnouncement="",this.lastAnnouncementTime=0}announce(e,t=!1){const n=Date.now();(t||e!==this.lastAnnouncement&&n-this.lastAnnouncementTime>=CONSTANTS.ANNOUNCEMENT_THROTTLE)&&(this.liveRegion.textContent=e,this.lastAnnouncement=e,this.lastAnnouncementTime=n)}}class OrganismState{constructor(){this.state={},this.urlStateManager=new URLStateManager}save(){const e={functions:this.getFunctionSelections(),parameters:this.getParameterValues(),timestamp:Date.now()};try{this.urlStateManager.saveToURL(e),debugLog("State saved to URL")}catch(e){debugLog("Failed to save state to URL:",e)}}load(){const e=this.urlStateManager.loadFromURL();return!!e&&(this.applyState(e),debugLog("State loaded from URL"),!0)}getFunctionSelections(){return{impulseX:document.querySelector('input[name="impulse-x"]:checked')?.value??"sin",impulseY:document.querySelector('input[name="impulse-y"]:checked')?.value??"cos",resonanceX:document.querySelector('input[name="resonance-x"]:checked')?.value??"sin",resonanceY:document.querySelector('input[name="resonance-y"]:checked')?.value??"cos"}}getParameterValues(){const e={};return Object.keys(this.controls).forEach((t=>{e[t]=parseFloat(this.controls[t].value)})),e}applyState(e){if(e.functions){const t={impulseX:"impulse-x",impulseY:"impulse-y",resonanceX:"resonance-x",resonanceY:"resonance-y"};Object.entries(e.functions).forEach((([e,n])=>{const a=t[e];if(a){const e=document.querySelector(`input[name="${a}"][value="${n}"]`);e&&(e.checked=!0)}}))}e.parameters&&Object.entries(e.parameters).forEach((([e,t])=>{this.controls[e]&&(this.controls[e].value=t)})),updateAnimation()}}class URLStateManager{constructor(){this.bindHashChange()}saveToURL(e){try{const t=this.createCleanHash(e);window.location.hash=t}catch(e){debugLog("Failed to save to URL:",e)}}loadFromURL(){try{const e=window.location.hash.slice(1);return e?this.parseCleanHash(e):null}catch(e){return debugLog("Failed to load from URL:",e),null}}createCleanHash(e){const{functions:t,parameters:n}=e,a={impulseX:"IX",impulseY:"IY",resonanceX:"RX",resonanceY:"RY"},o={size:"CS",canvas:"T",circulation:"C",mutation:"M",metabolism:"MB"};let r="";return Object.entries(t).forEach((([e,t])=>{const n=a[e];n&&(r+=n+t)})),Object.entries(n).forEach((([e,t])=>{const n=o[e];if(n){const e=Math.round(10*t)/10;r+=n+e}})),r}parseCleanHash(e){const t={IX:"impulseX",IY:"impulseY",RX:"resonanceX",RY:"resonanceY"},n={CS:"size",T:"canvas",C:"circulation",M:"mutation",MB:"metabolism"},a={},o={};let r=0;for(;r<e.length;){if(r+2<=e.length){const n=e.substring(r,r+2);if(t[n]){let o="",s=r+2;for(;s<e.length&&s<r+7&&/[a-z]/.test(e[s]);)o+=e[s],s++;if(o&&["sin","cos","tan","asin","acos","atan"].includes(o)){a[t[n]]=o,r=s;continue}}}let s=!1;for(const[t,a]of Object.entries(n))if(e.substring(r,r+t.length)===t){let n="",i=r+t.length;for(;i<e.length&&/[\d.]/.test(e[i]);)n+=e[i],i++;if(n){o[a]=parseFloat(n),r=i,s=!0;break}}s||r++}return{functions:a,parameters:o,timestamp:Date.now()}}bindHashChange(){window.addEventListener("hashchange",(()=>{const e=this.loadFromURL();e&&(organismState.applyState(e),liveRegionManager.announce("Organism loaded from shared URL"))}))}getShareableURL(){const e={functions:organismState.getFunctionSelections(),parameters:organismState.getParameterValues(),timestamp:Date.now()};return this.saveToURL(e),window.location.href}}class ParticleSystem{constructor(e,t,n){this.container=e,this.particles=[],this.generateParticles(t,n)}generateParticles(e,t){const n=document.createDocumentFragment();for(let a=1;a<=e;a++){const e=document.createElement("q");e.className=t,e.style.setProperty("--i",a),this.particles.push(e),n.appendChild(e)}this.container.appendChild(n)}regenerateParticles(e,t){this.container.innerHTML="",this.particles=[],this.generateParticles(e,t)}updatePositions(e){this.particles.forEach(((t,n)=>{const a=e[n];a&&(t.style.setProperty("--x-1",`${a.x1}px`),t.style.setProperty("--y-1",`${a.y1}px`),t.style.setProperty("--x-2",`${a.x2}px`),t.style.setProperty("--y-2",`${a.y2}px`))}))}}class MathFunctionManager{constructor(){this.functions=this.createMathFunctions()}createMathFunctions(){return{sin:e=>{try{const t=Math.sin(e);return isFinite(t)?t:0}catch(e){return debugLog("Math.sin error:",e),0}},cos:e=>{try{const t=Math.cos(e);return isFinite(t)?t:0}catch(e){return debugLog("Math.cos error:",e),0}},tan:e=>{try{const t=Math.tan(e);return isFinite(t)?Math.max(-1e3,Math.min(1e3,t)):0}catch(e){return debugLog("Math.tan error:",e),0}},asin:e=>{try{const t=Math.asin(Math.max(-1,Math.min(1,e)));return isFinite(t)?t:0}catch(e){return debugLog("Math.asin error:",e),0}},acos:e=>{try{const t=Math.acos(Math.max(-1,Math.min(1,e)));return isFinite(t)?t:0}catch(e){return debugLog("Math.acos error:",e),0}},atan:e=>{try{const t=Math.atan(e);return isFinite(t)?t:0}catch(e){return debugLog("Math.atan error:",e),0}}}}getFunction(e){return this.functions[e]??this.functions.sin}}class ControlManager{constructor(){this.controls={},this.outputs={},this.init()}init(){this.buildControls(),this.bindEvents()}buildControls(){document.querySelectorAll(".js-range-input").forEach((e=>{this.controls[e.id.replace("js-","")]=e})),document.querySelectorAll(".c-control-value").forEach((e=>{this.outputs[e.id.replace("js-","").replace("-value","")]=e}))}bindEvents(){let e;Object.values(this.controls).forEach((t=>{t.addEventListener("input",(()=>{cancelAnimationFrame(e),e=requestAnimationFrame((()=>{updateAnimation(),organismState.save()}))}))})),[...document.querySelectorAll('input[name="impulse-x"]'),...document.querySelectorAll('input[name="impulse-y"]'),...document.querySelectorAll('input[name="resonance-x"]'),...document.querySelectorAll('input[name="resonance-y"]')].forEach((e=>{e.addEventListener("change",(()=>{updateAnimation(),liveRegionManager.announcePatternChange(),organismState.save()}))}))}updateOutputs(){Object.keys(this.controls).forEach((e=>{const t=this.controls[e],n=this.outputs[e];n&&(n.textContent=t.value,t.setAttribute("aria-valuenow",t.value))}))}}const liveRegionManager=new LiveRegionManager,mathFunctionManager=new MathFunctionManager,controlManager=new ControlManager,organismState=new OrganismState;organismState.controls=controlManager.controls;const organism=document.querySelector(".js-organism"),mainParticleSystem=new ParticleSystem(organism,CONSTANTS.PARTICLE_COUNT,"c-particle");LiveRegionManager.prototype.announcePatternChange=function(){const e=document.querySelector('input[name="impulse-x"]:checked')?.value??"sin",t=document.querySelector('input[name="impulse-y"]:checked')?.value??"cos",n=document.querySelector('input[name="resonance-x"]:checked')?.value??"sin",a=document.querySelector('input[name="resonance-y"]:checked')?.value??"cos",o=parseFloat(controlManager.controls.circulation?.value??720),r=parseFloat(controlManager.controls.mutation?.value??18),s=parseFloat(controlManager.controls.metabolism?.value??12);let i="";i+=o<240?"tight spiral ":o<720?"flowing wave ":o<1200?"expanding circle ":"chaotic swirl ",i+=r<20?"with subtle variation":r<45?"with moderate fluctuation":r<70?"with dynamic shifts":"with wild mutations",i+=s<5?", moving slowly":s<10?", at steady pace":s<15?", pulsing rapidly":", vibrating intensely";const c=`Organism pattern shifted to ${i}. Functions: ${[e,n,a,t].join(", ")}`;this.announce(c)};const KEYBOARD_SHORTCUTS={Space:()=>randomizeParameters(),Escape:()=>{document.activeElement&&document.activeElement!==document.body&&document.activeElement.blur()}};function randomizeParameters(){const e=["cos","sin","tan","acos","asin","atan"],t=e[Math.floor(Math.random()*e.length)],n=e[Math.floor(Math.random()*e.length)],a=e[Math.floor(Math.random()*e.length)],o=e[Math.floor(Math.random()*e.length)],r=document.querySelector(`input[name="impulse-x"][value="${t}"]`),s=document.querySelector(`input[name="impulse-y"][value="${n}"]`),i=document.querySelector(`input[name="resonance-x"][value="${a}"]`),c=document.querySelector(`input[name="resonance-y"][value="${o}"]`);r&&(r.checked=!0),s&&(s.checked=!0),i&&(i.checked=!0),c&&(c.checked=!0),controlManager.controls.size.value=(7.5*Math.random()+.5).toFixed(1),controlManager.controls.canvas.value=Math.floor(280*Math.random()+20),controlManager.controls.canvas.value=10*Math.floor(controlManager.controls.canvas.value/10),controlManager.controls.circulation.value=30*Math.floor(48*Math.random()+1),controlManager.controls.mutation.value=Math.floor(90*Math.random()+1),controlManager.controls.metabolism.value=(19*Math.random()+1).toFixed(1),updateAnimation(),liveRegionManager.announcePatternChange(),organismState.save()}const updateAnimation=measurePerformance((function(){try{controlManager.updateOutputs();const e=parseFloat(controlManager.controls.size.value),t=parseFloat(controlManager.controls.canvas.value),n=parseFloat(controlManager.controls.circulation.value)*CONSTANTS.PI_180,a=parseFloat(controlManager.controls.mutation.value),o=parseFloat(controlManager.controls.metabolism.value),r=document.querySelector('input[name="impulse-x"]:checked'),s=document.querySelector('input[name="impulse-y"]:checked'),i=document.querySelector('input[name="resonance-x"]:checked'),c=document.querySelector('input[name="resonance-y"]:checked'),l=r?mathFunctionManager.getFunction(r.value):mathFunctionManager.getFunction("sin"),u=s?mathFunctionManager.getFunction(s.value):mathFunctionManager.getFunction("cos"),m=i?mathFunctionManager.getFunction(i.value):mathFunctionManager.getFunction("sin"),h=c?mathFunctionManager.getFunction(c.value):mathFunctionManager.getFunction("cos"),g=document.documentElement;g.style.setProperty("--cell-size",e);const d=getComputedStyle(g).getPropertyValue("--metabolism-offset").trim()-o;g.style.setProperty("--organism-duration",`${d}s`);const p=[];for(let e=1;e<=CONSTANTS.PARTICLE_COUNT;e++){const o=a*e*CONSTANTS.PI_180,r=e*n/CONSTANTS.PARTICLE_COUNT;let s=l(o)*t,i=u(o)*t,c=m(r)*t,d=h(r)*t;const M=t*parseInt(getComputedStyle(g).getPropertyValue("--canvas-multiplier").trim());s=isFinite(s)?Math.max(-M,Math.min(M,s)):0,i=isFinite(i)?Math.max(-M,Math.min(M,i)):0,c=isFinite(c)?Math.max(-M,Math.min(M,c)):0,d=isFinite(d)?Math.max(-M,Math.min(M,d)):0,p.push({x1:s,y1:i,x2:c,y2:d})}mainParticleSystem.updatePositions(p)}catch(e){console.error("Animation update error:",e);const t=document.documentElement;t.style.setProperty("--cell-size",CONSTANTS.DEFAULT_VALUES.size),t.style.setProperty("--organism-duration","7s")}}),"updateAnimation");document.addEventListener("keydown",(e=>{if(KEYBOARD_SHORTCUTS[e.code]&&!e.target.matches("input, button, a")&&(e.preventDefault(),KEYBOARD_SHORTCUTS[e.code]()),e.target.matches('input[type="range"]')){const t=e.target.step||1,n=parseFloat(e.target.value);if("ArrowUp"===e.code||"ArrowRight"===e.code){e.preventDefault();const a=Math.min(parseFloat(e.target.max),n+parseFloat(t));e.target.value=a,e.target.setAttribute("aria-valuenow",a),updateAnimation()}else if("ArrowDown"===e.code||"ArrowLeft"===e.code){e.preventDefault();const a=Math.max(parseFloat(e.target.min),n-parseFloat(t));e.target.value=a,e.target.setAttribute("aria-valuenow",a),updateAnimation()}}}));const randomizeButton=document.querySelector(".js-randomize");randomizeButton?randomizeButton.addEventListener("click",(e=>{e.preventDefault(),randomizeParameters()})):console.error("Randomize button not found");try{debugLog("Organism initializing...");organismState.load()||randomizeParameters(),debugLog("Organism initialization complete")}catch(e){console.error("Failed to initialize organism:",e),updateAnimation()}</script></body></html>
